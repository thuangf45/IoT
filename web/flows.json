[
    {
        "id": "a8b7dad562bce556",
        "type": "tab",
        "label": "Flow 1",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "c1af418266c0b277",
        "type": "ui_tab",
        "name": "Home",
        "icon": "dashboard",
        "disabled": false,
        "hidden": false
    },
    {
        "id": "cf4d34c4f50e4ab4",
        "type": "ui_base",
        "theme": {
            "name": "theme-custom",
            "lightTheme": {
                "default": "#0094CE",
                "baseColor": "#0094CE",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": true,
                "reset": false
            },
            "darkTheme": {
                "default": "#097479",
                "baseColor": "#56d1d7",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": true,
                "reset": false
            },
            "customTheme": {
                "name": "Untitled Theme 1",
                "default": "#4B7930",
                "baseColor": "#3e7e6b",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "reset": false
            },
            "themeState": {
                "base-color": {
                    "default": "#4B7930",
                    "value": "#3e7e6b",
                    "edited": true
                },
                "page-titlebar-backgroundColor": {
                    "value": "#72eecf",
                    "edited": true
                },
                "page-backgroundColor": {
                    "value": "#111111",
                    "edited": false
                },
                "page-sidebar-backgroundColor": {
                    "value": "#333333",
                    "edited": false
                },
                "group-textColor": {
                    "value": "#5aae95",
                    "edited": false
                },
                "group-borderColor": {
                    "value": "#3653c9",
                    "edited": true
                },
                "group-backgroundColor": {
                    "value": "#333333",
                    "edited": false
                },
                "widget-textColor": {
                    "value": "#eeeeee",
                    "edited": false
                },
                "widget-backgroundColor": {
                    "value": "#3e7e6b",
                    "edited": false
                },
                "widget-borderColor": {
                    "value": "#333333",
                    "edited": false
                },
                "base-font": {
                    "value": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
                }
            },
            "angularTheme": {
                "primary": "indigo",
                "accents": "blue",
                "warn": "red",
                "background": "grey",
                "palette": "light"
            }
        },
        "site": {
            "name": "Node-RED Dashboard",
            "hideToolbar": "false",
            "allowSwipe": "false",
            "lockMenu": "false",
            "allowTempTheme": "true",
            "dateFormat": "DD/MM/YYYY",
            "sizes": {
                "sx": 48,
                "sy": 48,
                "gx": 6,
                "gy": 6,
                "cx": 6,
                "cy": 6,
                "px": 0,
                "py": 0
            }
        }
    },
    {
        "id": "82a5e1c00c615aa0",
        "type": "mqtt-broker",
        "name": "Server",
        "broker": "http://broker.hivemq.com/",
        "port": 1883,
        "clientid": "",
        "autoConnect": true,
        "usetls": false,
        "protocolVersion": 4,
        "keepalive": 60,
        "cleansession": true,
        "autoUnsubscribe": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthRetain": "false",
        "birthPayload": "",
        "birthMsg": {},
        "closeTopic": "",
        "closeQos": "0",
        "closeRetain": "false",
        "closePayload": "",
        "closeMsg": {},
        "willTopic": "",
        "willQos": "0",
        "willRetain": "false",
        "willPayload": "",
        "willMsg": {},
        "userProps": "",
        "sessionExpiry": ""
    },
    {
        "id": "e1e4c62037626eb8",
        "type": "ui_group",
        "name": "Input User",
        "tab": "c1af418266c0b277",
        "order": 4,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "ca3e831c95101162",
        "type": "ui_group",
        "name": "Controls",
        "tab": "c1af418266c0b277",
        "order": 5,
        "disp": true,
        "width": 12,
        "collapse": false,
        "className": ""
    },
    {
        "id": "d5d2d5fa1fc29455",
        "type": "ui_group",
        "name": "Input Environment",
        "tab": "c1af418266c0b277",
        "order": 1,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "fd59ce93340abdd1",
        "type": "mqtt-broker",
        "name": "23124791",
        "broker": "localhost",
        "port": 1883,
        "clientid": "",
        "autoConnect": true,
        "usetls": false,
        "protocolVersion": 4,
        "keepalive": 60,
        "cleansession": true,
        "autoUnsubscribe": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthRetain": "false",
        "birthPayload": "",
        "birthMsg": {},
        "closeTopic": "",
        "closeQos": "0",
        "closeRetain": "false",
        "closePayload": "",
        "closeMsg": {},
        "willTopic": "",
        "willQos": "0",
        "willRetain": "false",
        "willPayload": "",
        "willMsg": {},
        "userProps": "",
        "sessionExpiry": ""
    },
    {
        "id": "c4365b2d258185a5",
        "type": "ui_group",
        "name": "Analysis",
        "tab": "c1af418266c0b277",
        "order": 2,
        "disp": true,
        "width": 6,
        "collapse": false,
        "className": ""
    },
    {
        "id": "92b69d34ad87d64d",
        "type": "ui_group",
        "name": "Violation Monitor",
        "tab": "c1af418266c0b277",
        "order": 3,
        "disp": true,
        "width": 6,
        "collapse": false,
        "className": ""
    },
    {
        "id": "098b42150c2f0fcb",
        "type": "mqtt-broker",
        "name": "Server 1",
        "broker": "test.mosquitto.org",
        "port": 1883,
        "clientid": "",
        "autoConnect": true,
        "usetls": false,
        "protocolVersion": 4,
        "keepalive": 60,
        "cleansession": true,
        "autoUnsubscribe": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthRetain": "false",
        "birthPayload": "",
        "birthMsg": {},
        "closeTopic": "",
        "closeQos": "0",
        "closeRetain": "false",
        "closePayload": "",
        "closeMsg": {},
        "willTopic": "",
        "willQos": "0",
        "willRetain": "false",
        "willPayload": "",
        "willMsg": {},
        "userProps": "",
        "sessionExpiry": ""
    },
    {
        "id": "ad9ea5942d3d9534",
        "type": "mqtt-broker",
        "name": "Server 2",
        "broker": "broker.emqx.io",
        "port": 1883,
        "clientid": "",
        "autoConnect": true,
        "usetls": false,
        "protocolVersion": 4,
        "keepalive": 60,
        "cleansession": true,
        "autoUnsubscribe": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthRetain": "false",
        "birthPayload": "",
        "birthMsg": {},
        "closeTopic": "",
        "closeQos": "0",
        "closeRetain": "false",
        "closePayload": "",
        "closeMsg": {},
        "willTopic": "",
        "willQos": "0",
        "willRetain": "false",
        "willPayload": "",
        "willMsg": {},
        "userProps": "",
        "sessionExpiry": ""
    },
    {
        "id": "dc0b13e6fad8121d",
        "type": "mqtt-broker",
        "name": "Server 3",
        "broker": "mqtt.eclipseprojects.io",
        "port": 1883,
        "clientid": "",
        "autoConnect": true,
        "usetls": false,
        "protocolVersion": 4,
        "keepalive": 60,
        "cleansession": true,
        "autoUnsubscribe": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthRetain": "false",
        "birthPayload": "",
        "birthMsg": {},
        "closeTopic": "",
        "closeQos": "0",
        "closeRetain": "false",
        "closePayload": "",
        "closeMsg": {},
        "willTopic": "",
        "willQos": "0",
        "willRetain": "false",
        "willPayload": "",
        "willMsg": {},
        "userProps": "",
        "sessionExpiry": ""
    },
    {
        "id": "d0599fa6836082e3",
        "type": "ui_spacer",
        "z": "a8b7dad562bce556",
        "name": "spacer",
        "group": "ca3e831c95101162",
        "order": 3,
        "width": 2,
        "height": 1
    },
    {
        "id": "c665e7c0feb139c2",
        "type": "ui_spacer",
        "z": "a8b7dad562bce556",
        "name": "spacer",
        "group": "ca3e831c95101162",
        "order": 8,
        "width": 1,
        "height": 1
    },
    {
        "id": "baa6950c5de45a2d",
        "type": "ui_spacer",
        "z": "a8b7dad562bce556",
        "name": "spacer",
        "group": "ca3e831c95101162",
        "order": 9,
        "width": 2,
        "height": 1
    },
    {
        "id": "6e2a1723d964bae1",
        "type": "ui_spacer",
        "z": "a8b7dad562bce556",
        "name": "spacer",
        "group": "ca3e831c95101162",
        "order": 13,
        "width": 1,
        "height": 1
    },
    {
        "id": "fd7915eda66e757d",
        "type": "ui_spacer",
        "z": "a8b7dad562bce556",
        "name": "spacer",
        "group": "ca3e831c95101162",
        "order": 14,
        "width": 12,
        "height": 1
    },
    {
        "id": "64b598faf15a255e",
        "type": "mqtt in",
        "z": "a8b7dad562bce556",
        "name": "esp32",
        "topic": "23clc06/23127491-23127483-23127467/in",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "ad9ea5942d3d9534",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 130,
        "y": 200,
        "wires": [
            [
                "9729607774cebe66",
                "7ff99e5be6390be6"
            ]
        ]
    },
    {
        "id": "2d34c17d4d5807ee",
        "type": "function",
        "z": "a8b7dad562bce556",
        "name": "Cloud In",
        "func": "// l·∫•y d·ªØ li·ªáu t·ª´ flow context\nvar temperature = flow.get(\"temperature\");\nvar humidity = flow.get(\"humidity\");\nvar brightness = flow.get(\"brightness\");\nvar velocity = flow.get(\"velocity\");\nvar distance = flow.get(\"distance\");\n\n// t·∫°o URL update cho ThingSpeak\nmsg.url = \"https://api.thingspeak.com/update?api_key=ST0K7JT3JRVC4PFI\"\n    + \"&field1=\" + (temperature || \"\")\n    + \"&field2=\" + (humidity || \"\")\n    + \"&field3=\" + (brightness || \"\")\n    + \"&field4=\" + (velocity || \"\")\n    + \"&field5=\" + (distance || \"\");\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 340,
        "wires": [
            [
                "261703c5d2ae0c4b"
            ]
        ]
    },
    {
        "id": "0e72a75000c0876b",
        "type": "ui_chart",
        "z": "a8b7dad562bce556",
        "name": "Temperature",
        "group": "d5d2d5fa1fc29455",
        "order": 1,
        "width": 0,
        "height": 0,
        "label": "Temperature",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "0",
        "ymax": "50",
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "3600",
        "cutout": 0,
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "useDifferentColor": false,
        "className": "",
        "x": 750,
        "y": 380,
        "wires": [
            []
        ]
    },
    {
        "id": "52a9bbca6bc511e5",
        "type": "mqtt out",
        "z": "a8b7dad562bce556",
        "name": "esp32",
        "topic": "23clc06/23127491/in",
        "qos": "2",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "ad9ea5942d3d9534",
        "x": 590,
        "y": 120,
        "wires": []
    },
    {
        "id": "574c4ca4d3373831",
        "type": "function",
        "z": "a8b7dad562bce556",
        "name": "Random Data",
        "func": "// H√†m random trong kho·∫£ng\nfunction randomInRange(min, max) {\n    return Math.floor(Math.random() * (max - min + 1)) + min;\n}\n\n// H√†m t·∫°o dao ƒë·ªông \"th·∫≠t h∆°n\"\nfunction realisticRandom(prev, min, max, commonMin, commonMax) {\n    let r = Math.random();\n\n    if (r < 0.4) {\n        // 40% dao ƒë·ªông quanh m·ª©c ph·ªï bi·∫øn (common range)\n        let base = randomInRange(commonMin, commonMax);\n        let variation = (Math.random() * 0.2 - 0.1) * base; // ¬±10%\n        let newVal = base + variation;\n        return Math.min(max, Math.max(min, Math.round(newVal)));\n    } else if (r < 0.45) {\n        // 5% dao ƒë·ªông nh·∫π quanh gi√° tr·ªã tr∆∞·ªõc ƒë√≥\n        let variation = (Math.random() * 0.1 - 0.05) * prev; // ¬±5%\n        let newVal = prev + variation;\n        return Math.min(max, Math.max(min, Math.round(newVal)));\n    } else if (r < 0.5) {\n        // 5% dao ƒë·ªông \"k√¨ qu·∫∑c\" (ngo√†i v√πng ph·ªï bi·∫øn)\n        let newVal = randomInRange(min, max);\n        return newVal;\n    } else {\n        // 50% gi·ªØ nguy√™n gi√° tr·ªã tr∆∞·ªõc ƒë√≥\n        return prev !== undefined ? prev : randomInRange(commonMin, commonMax);\n    }\n}\n\n// L·∫•y gi√° tr·ªã tr∆∞·ªõc ƒë√≥ t·ª´ flow context\nlet prevData = flow.get(\"prevData\") || {};\n\n// Sinh d·ªØ li·ªáu gi·∫£ l·∫≠p\nvar payload = {\n    type: \"Data\",\n    temperature: realisticRandom(prevData.temperature || 25, 10, 50, 28, 40),   // ¬∞C\n    humidity: realisticRandom(prevData.humidity || 50, 30, 90, 40, 60),        // %\n    brightness: realisticRandom(prevData.brightness || 500, 0, 1000, 200, 800),// lux\n    velocity: realisticRandom(prevData.velocity || 50, 0, 150, 40, 60),        // km/h\n    distance: realisticRandom(prevData.distance || 250, 0, 500, 100, 300)      // cm\n};\n\n// L∆∞u l·∫°i gi√° tr·ªã hi·ªán t·∫°i ƒë·ªÉ l·∫ßn sau d√πng\nflow.set(\"prevData\", payload);\n\nmsg.payload = JSON.stringify(payload);\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 420,
        "y": 120,
        "wires": [
            [
                "52a9bbca6bc511e5"
            ]
        ]
    },
    {
        "id": "55dbfaa8b2191f55",
        "type": "ui_chart",
        "z": "a8b7dad562bce556",
        "name": "Brightness",
        "group": "d5d2d5fa1fc29455",
        "order": 3,
        "width": 0,
        "height": 0,
        "label": "Brightness",
        "chartType": "bar",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "0",
        "ymax": "5000",
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "60",
        "cutout": 0,
        "useOneColor": true,
        "useUTC": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#fd7d0d",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#ffbb00"
        ],
        "outputs": 1,
        "useDifferentColor": false,
        "className": "",
        "x": 750,
        "y": 460,
        "wires": [
            []
        ]
    },
    {
        "id": "dd0af42c7f456c47",
        "type": "ui_chart",
        "z": "a8b7dad562bce556",
        "name": "Velocity Timeline",
        "group": "e1e4c62037626eb8",
        "order": 1,
        "width": 0,
        "height": 0,
        "label": "Velocity Timeline",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "0",
        "ymax": "150",
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "60",
        "cutout": 0,
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "useDifferentColor": false,
        "className": "",
        "x": 770,
        "y": 580,
        "wires": [
            []
        ]
    },
    {
        "id": "b02397b696319bd1",
        "type": "inject",
        "z": "a8b7dad562bce556",
        "name": "Trigger Environment Danger",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "30",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 170,
        "y": 640,
        "wires": [
            [
                "f335eb7f8a0a60f9"
            ]
        ]
    },
    {
        "id": "777e8ab80cde17f0",
        "type": "ui_gauge",
        "z": "a8b7dad562bce556",
        "name": "Humidity",
        "group": "d5d2d5fa1fc29455",
        "order": 2,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "Humidity",
        "label": "units",
        "format": "{{msg.payload}}",
        "min": 0,
        "max": "100",
        "colors": [
            "#ff0000",
            "#e6e600",
            "#00ff00"
        ],
        "seg1": "",
        "seg2": "",
        "diff": false,
        "className": "",
        "x": 740,
        "y": 420,
        "wires": []
    },
    {
        "id": "ddd4bdc30febc817",
        "type": "inject",
        "z": "a8b7dad562bce556",
        "name": "Trigger Check Violation",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "30",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 190,
        "y": 720,
        "wires": [
            [
                "515fefab6b300997"
            ]
        ]
    },
    {
        "id": "515fefab6b300997",
        "type": "function",
        "z": "a8b7dad562bce556",
        "name": "Count",
        "func": "// H√†m ki·ªÉm tra vi ph·∫°m\nfunction isViolation(velocity, distance) {\n    // V√≠ d·ª•: v·∫≠n t·ªëc > 60 km/h ho·∫∑c kho·∫£ng c√°ch < 50 cm th√¨ coi l√† vi ph·∫°m\n    return (velocity > 60 || distance < 30);\n}\n\n// L·∫•y d·ªØ li·ªáu t·ª´ flow\nconst velocity = flow.get(\"velocity\");\nconst distance = flow.get(\"distance\");\n\n// L·∫•y l·ªãch s·ª≠ vi ph·∫°m t·ª´ flow, n·∫øu ch∆∞a c√≥ th√¨ t·∫°o m·∫£ng r·ªóng\nlet violationHistory = flow.get(\"violationHistory\") || [];\n\n// Ki·ªÉm tra vi ph·∫°m\nif (isViolation(velocity, distance)) {\n    const now = Date.now();\n    let lastViolation = violationHistory[violationHistory.length - 1];\n\n    // N·∫øu ch∆∞a c√≥ l·ªói n√†o ho·∫∑c ƒë√£ c√°ch nhau >= 1 ph√∫t th√¨ th√™m m·ªõi\n    if (!lastViolation || (now - lastViolation.timestamp >= 60000)) {\n        violationHistory.push({\n            velocity: velocity,\n            distance: distance,\n            timestamp: now\n        });\n    }\n}\n\n// L∆∞u l·∫°i l·ªãch s·ª≠ v√†o flow\nflow.set(\"violationHistory\", violationHistory);\n\n// Tr·∫£ v·ªÅ s·ªë l·∫ßn vi ph·∫°m hi·ªán t·∫°i\nmsg.payload = violationHistory.length || 0;\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 410,
        "y": 720,
        "wires": [
            [
                "b9eca1b60e5360f1"
            ]
        ]
    },
    {
        "id": "c589713d18f2d57a",
        "type": "function",
        "z": "a8b7dad562bce556",
        "name": "Cloud Out",
        "func": "var payload = (typeof msg.payload === \"string\")\n    ? JSON.parse(msg.payload)\n    : msg.payload;\n\nvar feed = payload.feeds[0];\n\n// t·∫°o msg cho t·ª´ng output\nvar msg1 = feed.field1 !== null ? { payload: feed.field1 } : null;\nvar msg2 = feed.field2 !== null ? { payload: feed.field2 } : null;\nvar msg3 = feed.field3 !== null ? { payload: feed.field3 } : null;\nvar msg4 = feed.field4 !== null ? { payload: feed.field4 } : null;\nvar msg5 = feed.field5 !== null ? { payload: feed.field5 } : null;\n\nreturn [msg1, msg2, msg3, msg5];\n",
        "outputs": 4,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 580,
        "y": 440,
        "wires": [
            [
                "0e72a75000c0876b"
            ],
            [
                "777e8ab80cde17f0"
            ],
            [
                "55dbfaa8b2191f55"
            ],
            [
                "05c24ffa478d86c0"
            ]
        ]
    },
    {
        "id": "05c24ffa478d86c0",
        "type": "ui_chart",
        "z": "a8b7dad562bce556",
        "name": "Distance",
        "group": "e1e4c62037626eb8",
        "order": 3,
        "width": 0,
        "height": 0,
        "label": "Distance",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "0",
        "ymax": "500",
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "3600",
        "cutout": 0,
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "useDifferentColor": false,
        "className": "",
        "x": 740,
        "y": 500,
        "wires": [
            []
        ]
    },
    {
        "id": "b3ec4e1b1d107d10",
        "type": "ui_gauge",
        "z": "a8b7dad562bce556",
        "name": "Velocity (Live)",
        "group": "e1e4c62037626eb8",
        "order": 2,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "Velocity (Live)",
        "label": "units",
        "format": "{{msg.payload}}",
        "min": 0,
        "max": "150",
        "colors": [
            "#00ff00",
            "#ffff00",
            "#ff0000"
        ],
        "seg1": "",
        "seg2": "",
        "diff": false,
        "className": "",
        "x": 760,
        "y": 540,
        "wires": []
    },
    {
        "id": "8926b10b94454dfc",
        "type": "ui_chart",
        "z": "a8b7dad562bce556",
        "name": "AI Analysis",
        "group": "c4365b2d258185a5",
        "order": 1,
        "width": 0,
        "height": 0,
        "label": "AI Analysis",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "0",
        "ymax": "100",
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "3600",
        "cutout": 0,
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "useDifferentColor": false,
        "className": "",
        "x": 590,
        "y": 640,
        "wires": [
            []
        ]
    },
    {
        "id": "b9eca1b60e5360f1",
        "type": "ui_chart",
        "z": "a8b7dad562bce556",
        "name": "Check Violation",
        "group": "92b69d34ad87d64d",
        "order": 1,
        "width": 0,
        "height": 0,
        "label": "Check Violation",
        "chartType": "horizontalBar",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "0",
        "ymax": "100",
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "3600",
        "cutout": 0,
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "useDifferentColor": false,
        "className": "",
        "x": 600,
        "y": 720,
        "wires": [
            []
        ]
    },
    {
        "id": "7975959196fef2ce",
        "type": "mqtt out",
        "z": "a8b7dad562bce556",
        "name": "esp32",
        "topic": "23clc06/23127491-23127483-23127467/out",
        "qos": "2",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "ad9ea5942d3d9534",
        "x": 1010,
        "y": 780,
        "wires": []
    },
    {
        "id": "aa1bb2ea3e314350",
        "type": "function",
        "z": "a8b7dad562bce556",
        "name": "core 5",
        "func": "// Sinh d·ªØ li·ªáu gi·∫£ l·∫≠p\nvar payload = {\n    type: \"Lock Request\"\n};\nconst msg1 = { payload: JSON.stringify(payload) };\nconst msg2 = {payload: \"success: Th·ª±c hi·ªán thao t√°c th√†nh c√¥ng!\"};\n\nreturn [msg1, msg2];\n",
        "outputs": 2,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 750,
        "y": 780,
        "wires": [
            [
                "7975959196fef2ce"
            ],
            [
                "4a9c17b9a3b23678"
            ]
        ]
    },
    {
        "id": "b5029dce7a95852d",
        "type": "ui_button",
        "z": "a8b7dad562bce556",
        "name": "Lock Request",
        "group": "ca3e831c95101162",
        "order": 4,
        "width": 2,
        "height": 1,
        "passthru": false,
        "label": "Lock Request",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "Lock Request",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 120,
        "y": 780,
        "wires": [
            [
                "7326b163b12abb97"
            ]
        ]
    },
    {
        "id": "ae80da64fba640cf",
        "type": "inject",
        "z": "a8b7dad562bce556",
        "d": true,
        "name": "Generate Data ",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "3",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 160,
        "y": 120,
        "wires": [
            [
                "574c4ca4d3373831"
            ]
        ]
    },
    {
        "id": "37bdfc5c70690b99",
        "type": "function",
        "z": "a8b7dad562bce556",
        "name": "core 6",
        "func": "// Sinh d·ªØ li·ªáu gi·∫£ l·∫≠p\nvar payload = {\n    type: \"Lock\"\n};\n\nconst msg1 = { payload: JSON.stringify(payload) };\nconst msg2 = {payload: \"success: Th·ª±c hi·ªán thao t√°c th√†nh c√¥ng!\"};\n\nreturn [msg1, msg2];\n",
        "outputs": 2,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 750,
        "y": 820,
        "wires": [
            [
                "7975959196fef2ce"
            ],
            [
                "4a9c17b9a3b23678"
            ]
        ]
    },
    {
        "id": "853201b1a928f540",
        "type": "ui_button",
        "z": "a8b7dad562bce556",
        "name": "Lock",
        "group": "ca3e831c95101162",
        "order": 5,
        "width": 2,
        "height": 1,
        "passthru": false,
        "label": "Lock",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "Lock",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 150,
        "y": 820,
        "wires": [
            [
                "7326b163b12abb97"
            ]
        ]
    },
    {
        "id": "a4072e969b813247",
        "type": "function",
        "z": "a8b7dad562bce556",
        "name": "core 7",
        "func": "// Sinh d·ªØ li·ªáu gi·∫£ l·∫≠p\nvar payload = {\n    type: \"Unlock\"\n};\n\nconst msg1 = { payload: JSON.stringify(payload) };\nconst msg2 = {payload: \"success: Th·ª±c hi·ªán thao t√°c th√†nh c√¥ng!\"};\n\nreturn [msg1, msg2];\n",
        "outputs": 2,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 750,
        "y": 860,
        "wires": [
            [
                "7975959196fef2ce"
            ],
            [
                "4a9c17b9a3b23678"
            ]
        ]
    },
    {
        "id": "8317b75bd03c43dc",
        "type": "ui_button",
        "z": "a8b7dad562bce556",
        "name": "Unlock",
        "group": "ca3e831c95101162",
        "order": 6,
        "width": 2,
        "height": 1,
        "passthru": false,
        "label": "Unlock",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "Unlock",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 150,
        "y": 860,
        "wires": [
            [
                "7326b163b12abb97"
            ]
        ]
    },
    {
        "id": "2277fa9afa859c76",
        "type": "ui_button",
        "z": "a8b7dad562bce556",
        "name": "Clear Violation",
        "group": "ca3e831c95101162",
        "order": 7,
        "width": 3,
        "height": 1,
        "passthru": false,
        "label": "Clear Violation",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "Clear Violation",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 120,
        "y": 1020,
        "wires": [
            [
                "7326b163b12abb97"
            ]
        ]
    },
    {
        "id": "bea27f517f04a9e7",
        "type": "function",
        "z": "a8b7dad562bce556",
        "name": "core 11",
        "func": "flow.set(\"violationHistory\", []);\nmsg.payload = \"success: Th·ª±c hi·ªán thao t√°c th√†nh c√¥ng!\";\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 760,
        "y": 1020,
        "wires": [
            [
                "4a9c17b9a3b23678"
            ]
        ]
    },
    {
        "id": "261703c5d2ae0c4b",
        "type": "http request",
        "z": "a8b7dad562bce556",
        "name": "",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 570,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "7e85f30f76078baa",
        "type": "http request",
        "z": "a8b7dad562bce556",
        "name": "",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "https://api.thingspeak.com/channels/3189549/feeds.json?api_key=89TL01GQMO3W7D2V&results=1",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 390,
        "y": 440,
        "wires": [
            [
                "c589713d18f2d57a"
            ]
        ]
    },
    {
        "id": "9729607774cebe66",
        "type": "function",
        "z": "a8b7dad562bce556",
        "name": "Local Storage",
        "func": "var payload = (typeof msg.payload === \"string\") \n    ? JSON.parse(msg.payload) \n    : msg.payload;\n\nif (payload.type === \"Data\") {\n    if (payload.temperature !== null) flow.set(\"temperature\", payload.temperature);\n    if (payload.humidity !== null)    flow.set(\"humidity\", payload.humidity);\n    if (payload.brightness !== null)  flow.set(\"brightness\", payload.brightness);\n    if (payload.velocity !== null)    flow.set(\"velocity\", payload.velocity);\n    if (payload.distance !== null)    flow.set(\"distance\", payload.distance);\n}\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "08bc8309d1084001",
        "type": "inject",
        "z": "a8b7dad562bce556",
        "name": "Set Data Cloud Trigger",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "5",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 340,
        "wires": [
            [
                "2d34c17d4d5807ee"
            ]
        ]
    },
    {
        "id": "a2ba1550aef8e142",
        "type": "inject",
        "z": "a8b7dad562bce556",
        "name": "Get Data Cloud Trigger",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "30",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 440,
        "wires": [
            [
                "7e85f30f76078baa"
            ]
        ]
    },
    {
        "id": "f0eae16b4903ac78",
        "type": "inject",
        "z": "a8b7dad562bce556",
        "name": "Get Data Cloud Trigger",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "5",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 560,
        "wires": [
            [
                "adaac9f333f0fe1e"
            ]
        ]
    },
    {
        "id": "adaac9f333f0fe1e",
        "type": "http request",
        "z": "a8b7dad562bce556",
        "name": "",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "https://api.thingspeak.com/channels/3189549/feeds.json?api_key=89TL01GQMO3W7D2V&results=1",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 390,
        "y": 560,
        "wires": [
            [
                "27eaf837ec8e1d6e"
            ]
        ]
    },
    {
        "id": "27eaf837ec8e1d6e",
        "type": "function",
        "z": "a8b7dad562bce556",
        "name": "Cloud Out",
        "func": "var payload = (typeof msg.payload === \"string\")\n    ? JSON.parse(msg.payload)\n    : msg.payload;\n\nvar feed = payload.feeds[0];\n\nvar msg4 = feed.field4 !== null ? { payload: feed.field4 } : null;\n\n\nreturn [msg4, msg4];\n",
        "outputs": 2,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 580,
        "y": 560,
        "wires": [
            [
                "b3ec4e1b1d107d10"
            ],
            [
                "dd0af42c7f456c47"
            ]
        ]
    },
    {
        "id": "e1bc3c0f9c3c9d4a",
        "type": "ui_button",
        "z": "a8b7dad562bce556",
        "name": "Notify Buzzer",
        "group": "ca3e831c95101162",
        "order": 11,
        "width": 3,
        "height": 1,
        "passthru": false,
        "label": "Notify Buzzer",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "Notify Buzzer",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 130,
        "y": 900,
        "wires": [
            [
                "7326b163b12abb97"
            ]
        ]
    },
    {
        "id": "d4bf6ee94cbe419c",
        "type": "ui_button",
        "z": "a8b7dad562bce556",
        "name": "Notify Phone",
        "group": "ca3e831c95101162",
        "order": 12,
        "width": 3,
        "height": 1,
        "passthru": false,
        "label": "Notify Phone",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "Notify Phone",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 130,
        "y": 940,
        "wires": [
            [
                "7326b163b12abb97"
            ]
        ]
    },
    {
        "id": "ca82a06c599e0f15",
        "type": "ui_button",
        "z": "a8b7dad562bce556",
        "name": "Notify Email",
        "group": "ca3e831c95101162",
        "order": 10,
        "width": 3,
        "height": 1,
        "passthru": false,
        "label": "Notify Email",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "Notify Email",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 130,
        "y": 980,
        "wires": [
            [
                "7326b163b12abb97"
            ]
        ]
    },
    {
        "id": "59da42f5c37a15f7",
        "type": "function",
        "z": "a8b7dad562bce556",
        "name": "core 10",
        "func": "// Fallback cho time: N·∫øu kh√¥ng c√≥, l·∫•y th·ªùi gian hi·ªán t·∫°i (format gi·ªëng v√≠ d·ª•)\nconst time = msg.time || new Date().toLocaleString('vi-VN', { \n    day: '2-digit', \n    month: '2-digit', \n    year: 'numeric', \n    hour: '2-digit', \n    minute: '2-digit', \n    second: '2-digit', \n    hour12: true \n}).replace(',', ', ');  // Format: \"12/12/2025, 1:23:45 PM\" (d√πng vi-VN cho ti·∫øng Vi·ªát)\n\n// Fallback cho id: N·∫øu kh√¥ng c√≥, t·∫°o UUID ƒë∆°n gi·∫£n (v4 style, kh√¥ng c·∫ßn th∆∞ vi·ªán)\nfunction generateUUID() {\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n        var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\n        return v.toString(16);\n    });\n}\nconst id = msg.id || generateUUID();  // V√≠ d·ª•: \"a1b2c3d4-e5f6-4789-8901-23456789abcd\"\n\n// Gi·ªØ nguy√™n c√°c fallback kh√°c\nconst location = msg.location || \"Tr·∫°m ki·ªÉm so√°t A12\";\nconst description = msg.description || \"B·∫°n v·ª´a vi ph·∫°m giao th√¥ng (v∆∞·ª£t ƒë√®n ƒë·ªè / qu√° t·ªëc ƒë·ªô). H√¨nh ·∫£nh v√† bi√™n b·∫£n ƒë√£ ƒë∆∞·ª£c ghi nh·∫≠n t·ª± ƒë·ªông b·ªüi h·ªá th·ªëng camera.\";\nconst actions = msg.actions || [\n    \"Ki·ªÉm tra h√¨nh ·∫£nh v√† bi√™n b·∫£n trong h·ªá th·ªëng.\",\n    \"ƒê·∫øn kho b·∫°c nh√† n∆∞·ªõc ƒë·ªÉ ƒë√≥ng ph·∫°t ho·∫∑c n·ªôp ƒë∆°n khi·∫øu n·∫°i trong v√≤ng 7 ng√†y.\",\n    \"N·∫øu c·∫ßn h·ªó tr·ª£, li√™n h·ªá b·ªô ph·∫≠n h·ªó tr·ª£ theo th√¥ng tin d∆∞·ªõi.\"\n];\n\n// T·∫°o list actions HTML t·ª´ array\nconst actionsHtml = actions.map(action => `<li>${action}</li>`).join('');\n\nmsg.to = \"kingnemacc@gmail.com\";\nmsg.topic = \"Th√¥ng b√°o h·ªá th·ªëng\";\n\nmsg.payload = `\n    <!-- Email Notification Template - Responsive, inline CSS -->\n<table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"background:#f3f6f9;padding:30px 0;font-family:Arial,Helvetica,sans-serif;\">\n  <tr>\n    <td align=\"center\">\n      <table width=\"600\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"background:#ffffff;border-radius:8px;overflow:hidden;box-shadow:0 6px 18px rgba(0,0,0,0.06);\">\n        <!-- Header -->\n        <tr>\n          <td style=\"background:linear-gradient(90deg,#2563eb,#7c3aed);padding:22px 30px;color:#fff;\">\n            <h1 style=\"margin:0;font-size:20px;line-height:1.2;\">üîî Th√¥ng b√°o h·ªá th·ªëng</h1>\n            <p style=\"margin:6px 0 0;font-size:13px;opacity:0.95;\">H·ªá th·ªëng c·∫£nh b√°o t·ª± ƒë·ªông ‚Äî Vui l√≤ng ki·ªÉm tra th√¥ng tin b√™n d∆∞·ªõi.</p>\n          </td>\n        </tr>\n\n        <!-- Hero / Intro -->\n        <tr>\n          <td style=\"padding:22px 30px 0 30px;\">\n            <p style=\"margin:0 0 12px;color:#111;font-size:15px;line-height:1.5;\">\n              Xin ch√†o <strong>Ng∆∞·ªùi d√πng</strong>,\n            </p>\n            <p style=\"margin:0 0 12px;color:#333;font-size:14px;line-height:1.6;\">\n              H·ªá th·ªëng v·ª´a ph√°t hi·ªán m·ªôt s·ª± ki·ªán quan tr·ªçng li√™n quan ƒë·∫øn t√†i kho·∫£n c·ªßa b·∫°n. Vui l√≤ng ƒë·ªçc k·ªπ n·ªôi dung d∆∞·ªõi ƒë√¢y v√† l√†m theo h∆∞·ªõng d·∫´n n·∫øu c·∫ßn.\n            </p>\n          </td>\n        </tr>\n\n        <!-- Content block -->\n        <tr>\n          <td style=\"padding:8px 30px 0 30px;\">\n            <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"border-radius:6px;background:#f8fafc;border:1px solid #edf2f7;padding:14px;\">\n              <tr>\n                <td style=\"font-size:13px;color:#555;line-height:1.6;\">\n                  <strong>Th·ªùi gian:</strong> ${time}<br/>\n                  <strong>V·ªã tr√≠:</strong> ${location}<br/>\n                  <strong>M√¥ t·∫£:</strong> ${description}<br/><br/>\n                  <strong>H√†nh ƒë·ªông ƒë·ªÅ xu·∫•t:</strong>\n                  <ul style=\"margin:8px 0 0 18px;padding:0;color:#444;\">\n                    ${actionsHtml}\n                  </ul>\n                </td>\n              </tr>\n            </table>\n          </td>\n        </tr>\n\n        <!-- Big CTA -->\n        <tr>\n          <td align=\"center\" style=\"padding:18px 30px;\">\n            <a href=\"https://example.com/chi-tiet/${id}\" target=\"_blank\" style=\"display:inline-block;padding:12px 20px;border-radius:6px;text-decoration:none;font-weight:600;background:linear-gradient(90deg,#06b6d4,#3b82f6);color:#fff;\">\n              Xem chi ti·∫øt & x·ª≠ l√Ω\n            </a>\n          </td>\n        </tr>\n\n        <!-- Secondary info / long text -->\n        <tr>\n          <td style=\"padding:0 30px 18px 30px;font-size:13px;color:#555;line-height:1.6;\">\n            <p style=\"margin:0 0 10px;\">\n              <strong>Ghi ch√∫ quan tr·ªçng:</strong> N·∫øu b·∫°n cho r·∫±ng ƒë√¢y l√† nh·∫ßm l·∫´n, vui l√≤ng chu·∫©n b·ªã gi·∫•y t·ªù ch·ª©ng minh v√† th·ª±c hi·ªán khi·∫øu n·∫°i theo th·ªß t·ª•c. M·ªçi th√¥ng tin g·ª≠i l√™n h·ªá th·ªëng s·∫Ω ƒë∆∞·ª£c l∆∞u tr·ªØ v√† s·ª≠ d·ª•ng cho m·ª•c ƒë√≠ch x·ª≠ l√Ω vi ph·∫°m.\n            </p>\n            <p style=\"margin:0;\">\n              <strong>Li√™n h·ªá h·ªó tr·ª£:</strong><br/>\n              ƒêi·ªán tho·∫°i: 1900-1234 ‚Ä¢ Email: support@example.com ‚Ä¢ Gi·ªù l√†m vi·ªác: 08:00‚Äì17:00 (T2‚ÄìT6)\n            </p>\n          </td>\n        </tr>\n\n        <!-- Footer -->\n        <tr>\n          <td style=\"background:#fafafa;border-top:1px solid #f0f0f0;padding:14px 30px;font-size:12px;color:#7a7a7a;\">\n            <div style=\"display:flex;justify-content:space-between;align-items:center;\">\n              <div>¬© 2025 H·ªá th·ªëng Th√¥ng b√°o</div>\n              <div style=\"font-size:11px;opacity:0.9;\">B·∫°n nh·∫≠n email n√†y v√¨ ƒë√£ ƒëƒÉng k√Ω d·ªãch v·ª• th√¥ng b√°o t·ª± ƒë·ªông.</div>\n            </div>\n          </td>\n        </tr>\n      </table>\n    </td>\n  </tr>\n</table>\n`;\n\nconst msg1 = { payload: msg.payload, topic: msg.topic, to: msg.to };\nconst msg2 = {payload: \"success: Th·ª±c hi·ªán th√¥ng b√°o th√†nh c√¥ng!\"};\n\nreturn [msg1, msg2];",
        "outputs": 2,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 760,
        "y": 980,
        "wires": [
            [
                "7ab3af43e162fd04"
            ],
            [
                "4a9c17b9a3b23678"
            ]
        ]
    },
    {
        "id": "56f840a0ad63f266",
        "type": "function",
        "z": "a8b7dad562bce556",
        "name": "core 9",
        "func": "var notification = \n    \"B·∫°n v·ª´a vi ph·∫°m giao th√¥ng!\\n\" +\n    \"C·∫ßn ƒë·∫øn kho b·∫°c nh√† n∆∞·ªõc ƒë·ªÉ ƒë√≥ng ph·∫°t ho·∫∑c khi·∫øu n·∫°i!\\n\" +\n    \"Ch√∫c b·∫°n m·ªôt ng√†y t·ªët l√†nh!\";\n\nconst msg1 = { payload: notification };\nconst msg2 = {payload: \"success: Th·ª±c hi·ªán th√¥ng b√°o th√†nh c√¥ng!\"};\nreturn [msg1, msg2];",
        "outputs": 2,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 750,
        "y": 940,
        "wires": [
            [
                "787acbd0c36fbc3d"
            ],
            [
                "4a9c17b9a3b23678"
            ]
        ]
    },
    {
        "id": "ef3232a9d8ab497a",
        "type": "function",
        "z": "a8b7dad562bce556",
        "name": "core 8",
        "func": "var payload = {\n    type: \"Notify\"\n};\n\nconst msg1 = { payload: JSON.stringify(payload) };\nconst msg2 = { payload: \"success: Th·ª±c hi·ªán th√¥ng b√°o th√†nh c√¥ng!\" };\n\nreturn [msg1, msg2];",
        "outputs": 2,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 750,
        "y": 900,
        "wires": [
            [
                "7975959196fef2ce"
            ],
            [
                "4a9c17b9a3b23678"
            ]
        ]
    },
    {
        "id": "93b38a0c2bab36a2",
        "type": "ui_template",
        "z": "a8b7dad562bce556",
        "group": "ca3e831c95101162",
        "name": "ChatBox",
        "order": 15,
        "width": 0,
        "height": 0,
        "format": "<!-- Chatbox container -->\n<div id=\"chatBox\" style=\"\n    position: fixed;\n    bottom: 20px;\n    right: 20px;\n    width: 320px;\n    height: 420px;\n    display: flex;\n    flex-direction: column;\n    border-radius: 12px;\n    overflow: hidden;\n    box-shadow: \n        0 0 20px rgba(0, 255, 255, 0.3),\n        0 4px 30px rgba(0, 0, 0, 0.6);\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 100%);\n    color: #e0e0e0;\n    z-index: 9999;\n\">\n    <!-- Header -->\n    <div id=\"chatHeader\" style=\"\n        background: linear-gradient(90deg, #0f0f23, #16213e);\n        padding: 12px;\n        font-weight: 600;\n        text-align: center;\n        border-bottom: 1px solid rgba(0, 255, 255, 0.2);\n        color: #00ffff;\n        cursor: pointer;\n        text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);\n        transition: all 0.2s ease;\n        position: relative;\n    \">\n        <span style=\"position: relative; z-index: 1;\">üí¨ Cyber Chat</span>\n        <!-- Glow effect -->\n        <div style=\"\n            position: absolute;\n            top: 0;\n            left: 0;\n            right: 0;\n            bottom: 0;\n            background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.1), transparent);\n            opacity: 0;\n            transition: opacity 0.3s ease;\n        \"></div>\n    </div>\n\n    <!-- Body -->\n    <div id=\"chatWindow\" style=\"\n        flex: 1; \n        overflow-y: auto; \n        padding: 12px; \n        background: rgba(0, 0, 0, 0.3);\n        scrollbar-width: thin;\n        scrollbar-color: rgba(0, 255, 255, 0.5) transparent;\n    \">\n        <p\n            style=\"margin-bottom: 10px; padding: 8px 12px; border-radius: 12px; background: linear-gradient(135deg, rgba(138, 43, 226, 0.1), rgba(75, 0, 130, 0.05)); border-top: 3px solid #8a2be2; color: #8a2be2; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5); animation: messageSlideIn 0.3s ease;\">\n            <b style=\"color: #8a2be2; text-shadow: 0 0 5px rgba(138, 43, 226, 0.5);\">System:</b> Xin ch√†o, ƒë√¢y l√† chat\n            box cyber!\n        </p>\n    </div>\n\n    <!-- Footer -->\n    <div id=\"chatFooter\" style=\"\n        display: flex; \n        border-top: 1px solid rgba(0, 255, 255, 0.2); \n        background: linear-gradient(90deg, #0f0f23, #16213e); \n        padding: 10px;\n        transition: all 0.2s ease;\n    \">\n        <input id=\"chatInput\" type=\"text\" placeholder=\"Nh·∫≠p l·ªánh cyber...\"\n            style=\"\n                flex: 1; \n                padding: 8px 12px; \n                border: 1px solid rgba(0, 255, 255, 0.3);\n                border-radius: 20px; \n                margin-right: 8px; \n                background: rgba(26, 26, 46, 0.8);\n                color: #e0e0e0;\n                outline: none;\n                transition: all 0.2s ease;\n                box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);\n            \"\n            onfocus=\"this.style.borderColor='rgba(0, 255, 255, 0.6)'; this.style.boxShadow='0 0 10px rgba(0, 255, 255, 0.2)';\"\n            onblur=\"this.style.borderColor='rgba(0, 255, 255, 0.3)'; this.style.boxShadow='inset 0 2px 4px rgba(0, 0, 0, 0.3)';\"\n        />\n        <button onclick=\"sendMessage()\" id=\"sendBtn\" style=\"\n            background: linear-gradient(45deg, #00ffff, #0080ff);\n            color: white; \n            border: none; \n            border-radius: 20px; \n            padding: 8px 16px; \n            cursor: pointer;\n            font-weight: 600;\n            text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);\n            transition: all 0.3s ease;\n            box-shadow: 0 4px 15px rgba(0, 255, 255, 0.3);\n        \"\n        onmouseover=\"this.style.transform='scale(1.05)'; this.style.boxShadow='0 6px 20px rgba(0, 255, 255, 0.5)';\"\n        onmouseout=\"this.style.transform='scale(1)'; this.style.boxShadow='0 4px 15px rgba(0, 255, 255, 0.3)';\"\n        >üöÄ G·ª≠i</button>\n    </div>\n</div>\n\n<!-- N√∫t thu nh·ªè -->\n<div id=\"chatToggle\" style=\"\n    position: fixed;\n    bottom: 20px;\n    right: 20px;\n    width: 60px;\n    height: 60px;\n    border-radius: 50%;\n    background: linear-gradient(45deg, #00ffff, #0080ff);\n    color: white;\n    display: none;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    box-shadow: \n        0 0 20px rgba(0, 255, 255, 0.5),\n        0 4px 20px rgba(0, 0, 0, 0.4);\n    z-index: 9999;\n    transition: all 0.3s ease;\n    animation: pulse 2s infinite;\n\">\n    üí¨\n</div>\n\n<style>\n    @keyframes messageSlideIn {\n        from {\n            opacity: 0;\n            transform: translateX(-20px);\n        }\n\n        to {\n            opacity: 1;\n            transform: translateX(0);\n        }\n    }\n\n    @keyframes pulse {\n\n        0%,\n        100% {\n            transform: scale(1);\n        }\n\n        50% {\n            transform: scale(1.1);\n            box-shadow: 0 0 30px rgba(0, 255, 255, 0.7);\n        }\n    }\n\n    /* Custom scrollbar */\n    #chatWindow::-webkit-scrollbar {\n        width: 6px;\n    }\n\n    #chatWindow::-webkit-scrollbar-track {\n        background: rgba(0, 0, 0, 0.3);\n        border-radius: 3px;\n    }\n\n    #chatWindow::-webkit-scrollbar-thumb {\n        background: linear-gradient(180deg, #00ffff, #0080ff);\n        border-radius: 3px;\n        box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);\n    }\n\n    #chatWindow::-webkit-scrollbar-thumb:hover {\n        background: linear-gradient(180deg, #0080ff, #00ffff);\n    }\n</style>\n\n<script>\n    async function sendMessage() {\n    var input = document.getElementById(\"chatInput\");\n    var chatWindow = document.getElementById(\"chatWindow\");\n    if (input.value.trim() !== \"\") {\n      var msg = document.createElement(\"p\");\n      msg.style.cssText = \"margin-bottom: 10px; padding: 8px 12px; border-radius: 12px; background: linear-gradient(135deg, rgba(67, 181, 129, 0.2), rgba(0, 255, 0, 0.1)); border-left: 3px solid #00ff00; color: #43b581; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5); animation: messageSlideIn 0.3s ease;\";\n      msg.innerHTML = \"<b style='color:#00ff00; text-shadow: 0 0 5px rgba(0, 255, 0, 0.5);'>B·∫°n:</b> \" + input.value;\n      chatWindow.appendChild(msg);\n      chatWindow.scrollTop = chatWindow.scrollHeight;\n\n      try {\n        let response = await fetch(\"/chat\", {\n          method: \"POST\",\n          headers: {\"Content-Type\": \"application/json\"},\n          body: JSON.stringify({payload: input.value})\n        });\n        let data = await response.json();\n\n        var reply = document.createElement(\"p\");\n        reply.style.cssText = \"margin-bottom: 10px; padding: 8px 12px; border-radius: 12px; background: linear-gradient(135deg, rgba(0, 255, 255, 0.1), rgba(0, 128, 255, 0.05)); border-right: 3px solid #00ffff; color: #4da6ff; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5); animation: messageSlideIn 0.3s ease;\";\n        reply.innerHTML = \"<b style='color:#00ffff; text-shadow: 0 0 5px rgba(0, 255, 255, 0.5);'>Bot:</b> \" + data.payload;\n        chatWindow.appendChild(reply);\n        chatWindow.scrollTop = chatWindow.scrollHeight;\n      } catch (err) {\n        console.error(err);\n        var errorMsg = document.createElement(\"p\");\n        errorMsg.style.cssText = \"margin-bottom: 10px; padding: 8px 12px; border-radius: 12px; background: linear-gradient(135deg, rgba(138, 43, 226, 0.1), rgba(75, 0, 130, 0.05)); border-top: 3px solid #8a2be2; color: #ff6b6b; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5); animation: messageSlideIn 0.3s ease;\";\n        errorMsg.innerHTML = \"<b style='color:#ff6b6b; text-shadow: 0 0 5px rgba(255, 107, 107, 0.5);'>System:</b> L·ªói k·∫øt n·ªëi, th·ª≠ l·∫°i nh√©!\";\n        chatWindow.appendChild(errorMsg);\n        chatWindow.scrollTop = chatWindow.scrollHeight;\n      }\n\n      input.value = \"\";\n    }\n  }\n\n  // Enter ƒë·ªÉ g·ª≠i\n  document.getElementById(\"chatInput\").addEventListener(\"keypress\", function(e) {\n    if (e.key === \"Enter\") {\n      e.preventDefault();\n      sendMessage();\n    }\n  });\n\n  // Click header ƒë·ªÉ thu nh·ªè (th√™m hover glow)\n  document.getElementById(\"chatHeader\").addEventListener(\"click\", function() {\n    document.getElementById(\"chatBox\").style.display = \"none\";\n    document.getElementById(\"chatToggle\").style.display = \"flex\";\n  });\n  document.getElementById(\"chatHeader\").addEventListener(\"mouseenter\", function() {\n    this.querySelector('div').style.opacity = '1';\n    this.style.boxShadow = 'inset 0 0 20px rgba(0, 255, 255, 0.2)';\n  });\n  document.getElementById(\"chatHeader\").addEventListener(\"mouseleave\", function() {\n    this.querySelector('div').style.opacity = '0';\n    this.style.boxShadow = 'none';\n  });\n\n  // Click n√∫t bong b√≥ng ƒë·ªÉ m·ªü l·∫°i\n  document.getElementById(\"chatToggle\").addEventListener(\"click\", function() {\n    document.getElementById(\"chatBox\").style.display = \"flex\";\n    document.getElementById(\"chatToggle\").style.display = \"none\";\n  });\n</script>",
        "storeOutMessages": false,
        "fwdInMessages": true,
        "resendOnRefresh": false,
        "templateScope": "local",
        "className": "",
        "x": 140,
        "y": 1120,
        "wires": [
            []
        ]
    },
    {
        "id": "ee83794d0b2471a8",
        "type": "chatbot-nlpjs",
        "z": "a8b7dad562bce556",
        "name": "",
        "language": "",
        "debug": false,
        "scoreThreshold": "50",
        "x": 510,
        "y": 1380,
        "wires": [
            [
                "498da09dc08a4aac"
            ]
        ]
    },
    {
        "id": "ac159bca02be3470",
        "type": "chatbot-nlpjs-train",
        "z": "a8b7dad562bce556",
        "name": "",
        "debug": true,
        "x": 520,
        "y": 1260,
        "wires": [
            [
                "ddf8019980108c50"
            ]
        ]
    },
    {
        "id": "a8d7355cd69c3433",
        "type": "inject",
        "z": "a8b7dad562bce556",
        "name": "Train ChatBox",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 110,
        "y": 1260,
        "wires": [
            [
                "3038a00c32d10b01"
            ]
        ]
    },
    {
        "id": "498da09dc08a4aac",
        "type": "function",
        "z": "a8b7dad562bce556",
        "name": "Generate Message",
        "func": "msg.data = msg.payload;\n\nif (msg.payload.intent === \"greeting\") {\n    msg.payload = { payload: \"Xin ch√†o b·∫°n, t√¥i c√≥ th·ªÉ gi√∫p g√¨ cho b·∫°n.\" };\n}\nelse if (msg.payload.intent === \"thanks\") {\n    msg.payload = { payload: \"Kh√¥ng c√≥ g√¨, r·∫•t vui ƒë∆∞·ª£c gi√∫p b·∫°n.\" };\n}\nelse if (msg.payload.intent === \"goodbye\") {\n    msg.payload = { payload: \"T·∫°m bi·ªát, h·∫πn g·∫∑p l·∫°i b·∫°n sau.\" };\n}\nelse if (msg.payload.intent === \"ask_time\") {\n    msg.payload = { payload: \"B√¢y gi·ªù l√† \" + new Date().toLocaleTimeString(\"vi-VN\") };\n}\nelse if (msg.payload.intent === \"ask_weather\") {\n    msg.payload = { payload: \"Th·ªùi ti·∫øt hi·ªán t·∫°i kh√° d·ªÖ ch·ªãu, b·∫°n mu·ªën xem chi ti·∫øt theo th√†nh ph·ªë kh√¥ng?\" };\n}\nelse if (msg.payload.intent === \"ask_date\") {\n    msg.payload = { payload: \"H√¥m nay l√† ng√†y \" + new Date().toLocaleDateString(\"vi-VN\") };\n}\nelse if (msg.payload.intent === \"ask_day\") {\n    const days = [\"Ch·ªß nh·∫≠t\",\"Th·ª© hai\",\"Th·ª© ba\",\"Th·ª© t∆∞\",\"Th·ª© nƒÉm\",\"Th·ª© s√°u\",\"Th·ª© b·∫£y\"];\n    msg.payload = { payload: \"H√¥m nay l√† \" + days[new Date().getDay()] };\n}\nelse if (msg.payload.intent === \"ask_location\") {\n    msg.payload = { payload: \"B·∫°n ƒëang ·ªü Th√†nh ph·ªë H·ªì Ch√≠ Minh.\" }; // v√≠ d·ª• c·ªë ƒë·ªãnh\n}\nelse if (msg.payload.intent === \"ask_news\") {\n    msg.payload = { payload: \"Tin t·ª©c h√¥m nay: nhi·ªÅu s·ª± ki·ªán ƒë√°ng ch√∫ √Ω ƒëang di·ªÖn ra.\" };\n}\nelse if (msg.payload.intent === \"ask_joke\") {\n    msg.payload = { payload: \"ƒê√¢y l√† m·ªôt c√¢u chuy·ªán c∆∞·ªùi: V√¨ sao m√°y t√≠nh hay l·∫°nh? V√¨ n√≥ c√≥ nhi·ªÅu qu·∫°t!\" };\n}\nelse if (msg.payload.intent === \"ask_quote\") {\n    msg.payload = { payload: \"C√¢u n√≥i hay: 'H·ªçc, h·ªçc n·ªØa, h·ªçc m√£i' - L√™nin.\" };\n}\nelse if (msg.payload.intent === \"ask_music\") {\n    msg.payload = { payload: \"B·∫°n mu·ªën nghe nh·∫°c g√¨? T√¥i c√≥ th·ªÉ g·ª£i √Ω m·ªôt s·ªë b√†i h√°t n·ªïi ti·∫øng.\" };\n}\nelse if (msg.payload.intent === \"ask_movie\") {\n    msg.payload = { payload: \"C√≥ nhi·ªÅu phim hay, v√≠ d·ª•: 'Inception', 'Parasite'.\" };\n}\nelse if (msg.payload.intent === \"ask_food\") {\n    msg.payload = { payload: \"B·∫°n c√≥ th·ªÉ th·ª≠ ph·ªü, b√∫n b√≤, ho·∫∑c c∆°m t·∫•m.\" };\n}\nelse if (msg.payload.intent === \"ask_drink\") {\n    msg.payload = { payload: \"B·∫°n c√≥ th·ªÉ u·ªëng c√† ph√™ s·ªØa ƒë√° ho·∫∑c tr√† chanh.\" };\n}\nelse if (msg.payload.intent === \"ask_game\") {\n    msg.payload = { payload: \"B·∫°n c√≥ th·ªÉ ch∆°i c·ªù vua, Li√™n Qu√¢n, ho·∫∑c Among Us.\" };\n}\nelse if (msg.payload.intent === \"ask_sport\") {\n    msg.payload = { payload: \"Tin th·ªÉ thao: b√≥ng ƒë√° Vi·ªát Nam ƒëang chu·∫©n b·ªã cho gi·∫£i ƒë·∫•u m·ªõi.\" };\n}\nelse if (msg.payload.intent === \"ask_math\") {\n    msg.payload = { payload: \"B·∫°n c√≥ th·ªÉ ƒë∆∞a b√†i to√°n, t√¥i s·∫Ω gi√∫p gi·∫£i.\" };\n}\nelse if (msg.payload.intent === \"ask_translate\") {\n    msg.payload = { payload: \"B·∫°n mu·ªën d·ªãch c√¢u n√†o? H√£y nh·∫≠p n·ªôi dung.\" };\n}\nelse if (msg.payload.intent === \"ask_reminder\") {\n    msg.payload = { payload: \"T√¥i s·∫Ω gi√∫p b·∫°n ƒë·∫∑t nh·∫Øc nh·ªü, h√£y cho t√¥i bi·∫øt th·ªùi gian v√† n·ªôi dung.\" };\n}\nelse {\n    msg.payload = { payload: \"Xin l·ªói, t√¥i ch∆∞a hi·ªÉu √Ω b·∫°n.\" };\n}\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 730,
        "y": 1380,
        "wires": [
            [
                "0eaf8855eade2140"
            ]
        ]
    },
    {
        "id": "69e1a5b405182e90",
        "type": "http in",
        "z": "a8b7dad562bce556",
        "name": "ChatBot In",
        "url": "/chat",
        "method": "post",
        "upload": false,
        "skipBodyParsing": false,
        "swaggerDoc": "",
        "x": 100,
        "y": 1380,
        "wires": [
            [
                "2083c67b16aaed4a"
            ]
        ]
    },
    {
        "id": "2083c67b16aaed4a",
        "type": "function",
        "z": "a8b7dad562bce556",
        "name": "Prepare Data",
        "func": "msg.payload = msg.payload.payload || \"\";\nflow.set(\"data\", msg.payload);\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 290,
        "y": 1380,
        "wires": [
            [
                "ee83794d0b2471a8"
            ]
        ]
    },
    {
        "id": "ddf8019980108c50",
        "type": "chatbot-nlpjs-save",
        "z": "a8b7dad562bce556",
        "filename": "default",
        "outputs": 0,
        "x": 750,
        "y": 1260,
        "wires": []
    },
    {
        "id": "41c273e3b931b525",
        "type": "chatbot-nlpjs-load",
        "z": "a8b7dad562bce556",
        "filename": "default",
        "name": "default",
        "x": 290,
        "y": 1320,
        "wires": [
            []
        ]
    },
    {
        "id": "544b3b5c0b6f919f",
        "type": "inject",
        "z": "a8b7dad562bce556",
        "name": "Load ChatBox",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 110,
        "y": 1320,
        "wires": [
            [
                "41c273e3b931b525"
            ]
        ]
    },
    {
        "id": "0beab7ae7985fbae",
        "type": "http response",
        "z": "a8b7dad562bce556",
        "name": "ChatBot Out",
        "statusCode": "",
        "headers": {},
        "x": 890,
        "y": 1460,
        "wires": []
    },
    {
        "id": "3038a00c32d10b01",
        "type": "function",
        "z": "a8b7dad562bce556",
        "name": "Prepare Dataset",
        "func": "msg.payload = {\n  intents: {\n    vi: {\n      thanks: [\n        \"C·∫£m ∆°n\", \"C·∫£m ∆°n b·∫°n\", \"C·∫£m ∆°n nhi·ªÅu\", \"C·∫£m ∆°n nhi·ªÅu l·∫Øm\",\n        \"Xin c·∫£m ∆°n\", \"C√°m ∆°n nh√©\", \"C·∫£m ∆°n b·∫°n r·∫•t nhi·ªÅu\",\n        \"Thanks\", \"Thank you\", \"Thanks a lot\", \"Much appreciated\"\n      ],\n      greeting: [\n        \"Xin ch√†o\", \"Xin ch√†o b·∫°n\", \"Ch√†o b·∫°n\", \"Hello\", \"Hi b·∫°n\",\n        \"R·∫•t vui g·∫∑p b·∫°n\", \"Ch√†o bu·ªïi s√°ng\", \"Ch√†o bu·ªïi t·ªëi\",\n        \"Hey\", \"Ch√†o c·∫≠u\", \"Hello there\"\n      ],\n      goodbye: [\n        \"T·∫°m bi·ªát\", \"Bye\", \"H·∫πn g·∫∑p l·∫°i\", \"See you later\", \"Ch√†o t·∫°m bi·ªát\"\n      ],\n      ask_time: [\n        \"M·∫•y gi·ªù r·ªìi\", \"B√¢y gi·ªù l√† m·∫•y gi·ªù\", \"Gi·ªù hi·ªán t·∫°i\", \"Cho t√¥i bi·∫øt th·ªùi gian\"\n      ],\n      ask_weather: [\n        \"Th·ªùi ti·∫øt h√¥m nay th·∫ø n√†o\", \"Ngo√†i tr·ªùi ra sao\", \"D·ª± b√°o th·ªùi ti·∫øt\", \"Tr·ªùi h√¥m nay th·∫ø n√†o\"\n      ],\n      ask_date: [\n        \"H√¥m nay l√† ng√†y g√¨\", \"Ng√†y th√°ng nƒÉm hi·ªán t·∫°i\", \"H√¥m nay l√† ng√†y bao nhi√™u\"\n      ],\n      ask_day: [\n        \"H√¥m nay l√† th·ª© m·∫•y\", \"Ng√†y n√†y l√† th·ª© g√¨\", \"Cho t√¥i bi·∫øt h√¥m nay l√† th·ª© m·∫•y\"\n      ],\n      ask_location: [\n        \"T√¥i ƒëang ·ªü ƒë√¢u\", \"B·∫°n c√≥ bi·∫øt v·ªã tr√≠ c·ªßa t√¥i kh√¥ng\", \"Cho t√¥i bi·∫øt ƒë·ªãa ƒëi·ªÉm hi·ªán t·∫°i\"\n      ],\n      ask_news: [\n        \"Tin t·ª©c h√¥m nay\", \"C√≥ g√¨ m·ªõi kh√¥ng\", \"Cho t√¥i bi·∫øt tin t·ª©c m·ªõi nh·∫•t\"\n      ],\n      ask_joke: [\n        \"K·ªÉ chuy·ªán c∆∞·ªùi ƒëi\", \"Cho t√¥i m·ªôt c√¢u ƒë√πa\", \"B·∫°n c√≥ bi·∫øt chuy·ªán vui n√†o kh√¥ng\"\n      ],\n      ask_quote: [\n        \"Cho t√¥i m·ªôt c√¢u n√≥i hay\", \"Tr√≠ch d·∫´n n·ªïi ti·∫øng\", \"C√¢u n√≥i truy·ªÅn c·∫£m h·ª©ng\"\n      ],\n      ask_music: [\n        \"Ph√°t nh·∫°c ƒëi\", \"Cho t√¥i nghe m·ªôt b√†i h√°t\", \"M·ªü nh·∫°c\"\n      ],\n      ask_movie: [\n        \"Phim g√¨ hay\", \"ƒê·ªÅ xu·∫•t phim\", \"C√≥ phim n√†o m·ªõi kh√¥ng\"\n      ],\n      ask_food: [\n        \"ƒÇn g√¨ b√¢y gi·ªù\", \"G·ª£i √Ω m√≥n ƒÉn\", \"T√¥i n√™n ƒÉn g√¨\"\n      ],\n      ask_drink: [\n        \"U·ªëng g√¨ b√¢y gi·ªù\", \"G·ª£i √Ω ƒë·ªì u·ªëng\", \"T√¥i n√™n u·ªëng g√¨\"\n      ],\n      ask_game: [\n        \"Ch∆°i game g√¨\", \"ƒê·ªÅ xu·∫•t tr√≤ ch∆°i\", \"C√≥ game n√†o vui kh√¥ng\"\n      ],\n      ask_sport: [\n        \"Tin th·ªÉ thao h√¥m nay\", \"K·∫øt qu·∫£ b√≥ng ƒë√°\", \"C√≥ tr·∫≠n n√†o t·ªëi nay kh√¥ng\"\n      ],\n      ask_math: [\n        \"Gi·∫£i to√°n gi√∫p t√¥i\", \"T√≠nh to√°n\", \"L√†m ph√©p c·ªông tr·ª´\"\n      ],\n      ask_translate: [\n        \"D·ªãch sang ti·∫øng Anh\", \"D·ªãch sang ti·∫øng Vi·ªát\", \"Translate this\"\n      ],\n      ask_reminder: [\n        \"ƒê·∫∑t nh·∫Øc nh·ªü\", \"Nh·∫Øc t√¥i vi·ªác n√†y\", \"T·∫°o reminder\"\n      ]\n    }\n  }\n};\n\nflow.set(\"dataset\", msg.payload);\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 300,
        "y": 1260,
        "wires": [
            [
                "ac159bca02be3470"
            ]
        ]
    },
    {
        "id": "0eaf8855eade2140",
        "type": "function",
        "z": "a8b7dad562bce556",
        "name": "Combine Message",
        "func": "let responses = flow.get(\"responses\") || []; \n// th√™m v√†o cu·ªëi m·∫£ng \nresponses.push(msg.payload.payload); \nflow.set(\"responses\", responses); \nmsg.payload = msg.data;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 930,
        "y": 1380,
        "wires": [
            [
                "225d29c0e867dc4b"
            ]
        ]
    },
    {
        "id": "225d29c0e867dc4b",
        "type": "function",
        "z": "a8b7dad562bce556",
        "name": "Dispatcher",
        "func": "let dataset = flow.get(\"dataset\") || {};\nlet intent = msg.payload.intent;\nlet text = flow.get(\"data\") || \"\";\n\n// Escape regex k√Ω t·ª± ƒë·∫∑c bi·ªát\nfunction escapeRegex(s) {\n    return s.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\");\n}\n\n// Chu·∫©n ho√° text: b·ªè d·∫•u c√¢u, ƒë∆∞a v·ªÅ lower-case\nfunction normalize(str) {\n    return str.toLowerCase().replace(/[,\\.;:!?]/g, \"\").trim();\n}\n\nif (dataset.intents && dataset.intents.vi && dataset.intents.vi[intent]) {\n    const utterances = dataset.intents.vi[intent].map(u => normalize(u));\n    let textNorm = normalize(text);\n    const oldText = textNorm;\n    let changed = false;\n\n    // Th·ª≠ t·ª´ng utterance b·∫±ng regex kh√¥ng ph√¢n bi·ªát hoa/th∆∞·ªùng\n    for (let u of utterances) {\n        const regex = new RegExp(\"\\\\b\" + escapeRegex(u) + \"\\\\b\", \"i\");\n        if (regex.test(textNorm)) {\n            textNorm = textNorm.replace(regex, \"\").trim();\n            changed = true;\n            break; // ƒë√£ x·ª≠ l√Ω intent n√†y, tho√°t lu√¥n\n        }\n    }\n\n    text = textNorm;\n\n    // N·∫øu kh√¥ng thay ƒë·ªïi, bu·ªôc tho√°t ƒë·ªÉ tr√°nh v√≤ng l·∫∑p v√¥ h·∫°n\n    if (!changed || text === oldText) {\n        text = \"\";\n    }\n\n    flow.set(\"data\", text);\n} else {\n    // Fallback: intent kh√¥ng c√≥ trong dataset\n    let responses = flow.get(\"responses\") || [];\n    if (!responses.includes(\"Xin l·ªói, t√¥i ch∆∞a hi·ªÉu √Ω b·∫°n.\")) {\n        responses.push(\"Xin l·ªói, t√¥i ch∆∞a hi·ªÉu √Ω b·∫°n.\");\n    }\n    flow.set(\"responses\", responses);\n    text = \"\";\n    flow.set(\"data\", text);\n}\n\n// Nh√°nh xu·∫•t\nif (text && text.length > 0) {\n    // c√≤n ph·∫ßn ch∆∞a x·ª≠ l√Ω => quay l·∫°i c·ªïng 1 ƒë·ªÉ classifier t√¨m intent ti·∫øp theo\n    msg.payload = text;\n    return [msg, null];\n} else {\n    // h·∫øt ph·∫ßn ch∆∞a x·ª≠ l√Ω => join v√† clear\n    let responses = flow.get(\"responses\") || [];\n    const finalResponse = responses.join(\" \");\n\n    flow.set(\"responses\", []);\n    flow.set(\"data\", \"\");\n\n    msg.payload = finalResponse;\n    return [null, msg];\n}\n",
        "outputs": 2,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 470,
        "y": 1460,
        "wires": [
            [
                "ee83794d0b2471a8"
            ],
            [
                "157100e229455814"
            ]
        ]
    },
    {
        "id": "157100e229455814",
        "type": "function",
        "z": "a8b7dad562bce556",
        "name": "Prepare Data",
        "func": "msg.payload = {payload: msg.payload};\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 690,
        "y": 1460,
        "wires": [
            [
                "0beab7ae7985fbae"
            ]
        ]
    },
    {
        "id": "b7d10944739880a1",
        "type": "http request",
        "z": "a8b7dad562bce556",
        "name": "phone",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1190,
        "y": 940,
        "wires": [
            []
        ]
    },
    {
        "id": "787acbd0c36fbc3d",
        "type": "function",
        "z": "a8b7dad562bce556",
        "name": "Prepare Data",
        "func": "const message = encodeURIComponent(msg.payload || \"\");\n\nmsg.url = \"https://www.pushsafer.com/api\"\n        + \"?k=owqOKgLJxtJ5m889IYjg\"\n        + \"&m=\" + message;\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1030,
        "y": 940,
        "wires": [
            [
                "b7d10944739880a1"
            ]
        ]
    },
    {
        "id": "7ab3af43e162fd04",
        "type": "e-mail",
        "z": "a8b7dad562bce556",
        "server": "smtp.gmail.com",
        "port": "465",
        "authtype": "BASIC",
        "saslformat": true,
        "token": "oauth2Response.access_token",
        "secure": true,
        "tls": true,
        "name": "",
        "dname": "",
        "x": 1010,
        "y": 980,
        "wires": []
    },
    {
        "id": "4a9c17b9a3b23678",
        "type": "ui_template",
        "z": "a8b7dad562bce556",
        "group": "ca3e831c95101162",
        "name": "Toast Notify",
        "order": 1,
        "width": 0,
        "height": 0,
        "format": "<style>\n    #toast-container {\n        position: fixed;\n        top: 20px;\n        right: 20px;\n        z-index: 999999;\n        display: flex;\n        flex-direction: column;\n        gap: 12px;\n        pointer-events: none;\n    }\n\n    .toast {\n        position: relative;\n        padding: 16px 20px;\n        min-width: 280px;\n        max-width: 380px;\n        color: #fff;\n        font-size: 14px;\n        border-radius: 12px;\n        display: flex;\n        align-items: center;\n        gap: 12px;\n        background: rgba(30, 30, 30, 0.75);\n        backdrop-filter: blur(12px);\n        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.35);\n        overflow: hidden;\n\n        opacity: 0;\n        transform: translateX(40px);\n        animation: slideIn 0.45s ease forwards,\n            fadeOut 0.6s ease 4.5s forwards;\n    }\n\n    /* --- Glowing border animation --- */\n    .toast::before {\n        content: \"\";\n        position: absolute;\n        inset: 0;\n        border-radius: 12px;\n        padding: 2px;\n        background: linear-gradient(130deg,\n                #16a34a,\n                #22d3ee,\n                #6366f1,\n                #f43f5e,\n                #f59e0b);\n        background-size: 300% 300%;\n        animation: glowBorder 3s linear infinite;\n        -webkit-mask:\n            linear-gradient(#fff 0 0) content-box,\n            linear-gradient(#fff 0 0);\n        -webkit-mask-composite: xor;\n        mask-composite: exclude;\n    }\n\n    /* m√†u theo lo·∫°i */\n    .toast.success::before {\n        filter: hue-rotate(0deg);\n    }\n\n    .toast.error::before {\n        filter: hue-rotate(280deg);\n    }\n\n    .toast.warning::before {\n        filter: hue-rotate(80deg);\n    }\n\n    .toast.info::before {\n        filter: hue-rotate(180deg);\n    }\n\n    @keyframes glowBorder {\n        0% {\n            background-position: 0% 50%;\n        }\n\n        50% {\n            background-position: 100% 50%;\n        }\n\n        100% {\n            background-position: 0% 50%;\n        }\n    }\n\n    @keyframes slideIn {\n        to {\n            opacity: 1;\n            transform: translateX(0);\n        }\n    }\n\n    @keyframes fadeOut {\n        to {\n            opacity: 0;\n            transform: translateX(40px);\n        }\n    }\n\n    .icon {\n        font-size: 20px;\n        opacity: 0.9;\n    }\n</style>\n\n\n<div id=\"toast-container\"></div>\n\n<script>\n    (function(scope) {\n\n    scope.$watch(\"msg\", function(msg) {\n        if (!msg || !msg.payload) return;\n\n        let raw = String(msg.payload);\n        let type = \"info\";\n        let text = raw;\n\n        if (raw.startsWith(\"success:\")) { type = \"success\"; text = raw.replace(\"success:\", \"\").trim(); }\n        else if (raw.startsWith(\"error:\")) { type = \"error\"; text = raw.replace(\"error:\", \"\").trim(); }\n        else if (raw.startsWith(\"warning:\")) { type = \"warning\"; text = raw.replace(\"warning:\", \"\").trim(); }\n        else if (raw.startsWith(\"info:\")) { type = \"info\"; text = raw.replace(\"info:\", \"\").trim(); }\n\n        const icons = {\n            success: \"‚úî\",\n            error: \"‚úñ\",\n            warning: \"‚ö†\",\n            info: \"‚Ñπ\"\n        };\n\n        const toast = document.createElement(\"div\");\n        toast.className = \"toast \" + type;\n        toast.innerHTML = `\n            <div class=\"icon\">${icons[type]}</div>\n            <div>${text}</div>\n        `;\n\n        const container = document.getElementById(\"toast-container\");\n        container.appendChild(toast);\n\n        setTimeout(() => toast.remove(), 5000);\n    });\n\n})(scope);\n</script>",
        "storeOutMessages": false,
        "fwdInMessages": true,
        "resendOnRefresh": false,
        "templateScope": "local",
        "className": "",
        "x": 1030,
        "y": 880,
        "wires": [
            []
        ]
    },
    {
        "id": "3dca5b9467d8c56d",
        "type": "ui_template",
        "z": "a8b7dad562bce556",
        "group": "ca3e831c95101162",
        "name": "Form",
        "order": 2,
        "width": 0,
        "height": 0,
        "format": "<style>\n    /* Overlay m·ªù */\n    #custom-modal-overlay {\n        position: fixed;\n        inset: 0;\n        background: rgba(0, 0, 0, 0.45);\n        backdrop-filter: blur(4px);\n        display: none;\n        justify-content: center;\n        align-items: center;\n        z-index: 999998;\n    }\n\n    /* Popup */\n    #custom-modal {\n        width: 380px;\n        padding: 22px;\n        background: rgba(255, 255, 255, 0.10);\n        border: 1px solid rgba(255, 255, 255, 0.2);\n        backdrop-filter: blur(16px);\n        border-radius: 14px;\n        box-shadow: 0 10px 28px rgba(0, 0, 0, 0.35);\n        color: #fff;\n        opacity: 0;\n        transform: scale(0.85);\n        transition: 0.25s ease;\n    }\n\n    #custom-modal.show {\n        opacity: 1;\n        transform: scale(1);\n    }\n\n    /* Title */\n    #custom-modal h3 {\n        margin: 0 0 10px 0;\n        font-size: 18px;\n        font-weight: 600;\n    }\n\n    /* Buttons */\n    .modal-btns {\n        display: flex;\n        justify-content: flex-end;\n        margin-top: 20px;\n        gap: 10px;\n    }\n\n    .btn {\n        padding: 8px 16px;\n        border-radius: 8px;\n        cursor: pointer;\n        border: none;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n\n    .btn.cancel {\n        background: rgba(255, 255, 255, 0.15);\n        color: #fff;\n    }\n\n    .btn.cancel:hover {\n        background: rgba(255, 255, 255, 0.25);\n    }\n\n    .btn.ok {\n        background: #2563eb;\n        color: #fff;\n    }\n\n    .btn.ok:hover {\n        background: #1d4ed8;\n    }\n</style>\n\n<!-- Modal -->\n<div id=\"custom-modal-overlay\">\n    <div id=\"custom-modal\">\n        <h3>X√°c nh·∫≠n thao t√°c</h3>\n        <p>B·∫°n c√≥ ch·∫Øc mu·ªën th·ª±c hi·ªán h√†nh ƒë·ªông n√†y?</p>\n        <div class=\"modal-btns\">\n            <button class=\"btn cancel\" ng-click=\"cancelModal()\">H·ªßy</button>\n            <button class=\"btn ok\" ng-click=\"confirmModal()\">ƒê·ªìng √Ω</button>\n        </div>\n    </div>\n</div>\n\n<script>\n    (function(scope) {\n    const overlay = document.getElementById(\"custom-modal-overlay\");\n    const modal = document.getElementById(\"custom-modal\");\n   \n    // Bi·∫øn l∆∞u fromnode t·∫°m th·ªùi\n    scope.currentFromNode = null;\n   \n    scope.$watch(\"msg\", function(msg) {\n        if (!msg || !msg.payload) return;\n        let p = msg.payload;\n        if (p && p.action === \"showForm\") {\n            // Th√™m check: N·∫øu fromnode r·ªóng, warn v√† kh√¥ng show modal\n            if (!p.fromnode || p.fromnode.toString().trim() === \"\") {\n                console.warn(\"Modal: fromnode r·ªóng ‚Üí Kh√¥ng show modal\");  // Log browser console\n                return;  // B·ªè qua, kh√¥ng show\n            }\n            scope.currentFromNode = p.fromnode;  // L∆∞u ch·ªâ n·∫øu h·ª£p l·ªá\n            showModal();\n        }\n        if (p && p.action === \"hideForm\") {\n            hideModal();\n        }\n    });\n\n    function showModal() {\n        overlay.style.display = \"flex\";\n        setTimeout(() => modal.classList.add(\"show\"), 20);\n    }\n\n    function hideModal() {\n        modal.classList.remove(\"show\");\n        setTimeout(() => overlay.style.display = \"none\", 200);\n        scope.currentFromNode = null;  // Reset\n    }\n\n    scope.cancelModal = function() {\n        let result = { action: \"cancelled\" };\n        if (scope.currentFromNode !== null && scope.currentFromNode.toString().trim() !== \"\") {\n            result.fromnode = scope.currentFromNode;\n        }\n        hideModal();\n        scope.send({ payload: result });\n    };\n\n    scope.confirmModal = function() {\n        let result = { action: \"confirmed\" };\n        if (scope.currentFromNode !== null && scope.currentFromNode.toString().trim() !== \"\") {\n            result.fromnode = scope.currentFromNode;\n        }\n        hideModal();\n        scope.send({ payload: result });\n    };\n})(scope);\n</script>",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "resendOnRefresh": false,
        "templateScope": "local",
        "className": "",
        "x": 450,
        "y": 900,
        "wires": [
            [
                "a3ae76c9a0a1400a"
            ]
        ]
    },
    {
        "id": "a3ae76c9a0a1400a",
        "type": "function",
        "z": "a8b7dad562bce556",
        "name": "Check",
        "func": "let p = msg.payload;\n\nif (p && p.action === \"confirmed\") {\n    // Ng∆∞·ªùi d√πng b·∫•m ƒê·ªìng √Ω\n    let fromNode = (p.fromnode || \"\").toString().trim();  // Trim space th·ª´a, convert sang string n·∫øu c·∫ßn\n    if (fromNode === \"Lock Request\") {\n\n        return [msg, null, null, null, null, null, null, null];\n    } else if (fromNode === \"Lock\") {\n        return [null, msg, null, null, null, null, null, null];\n    } else if (fromNode === \"Unlock\") {\n        return [null, null, msg, null, null, null, null, null];\n    } else if (fromNode === \"Notify Buzzer\") {\n        return [null, null, null, msg, null, null, null, null];\n    } else if (fromNode === \"Notify Phone\") {\n        return [null, null, null, null, msg, null, null, null];\n    } else if (fromNode === \"Notify Email\") {\n        return [null, null, null, null, null, msg, null, null];\n    } else if (fromNode === \"Clear Violation\") {\n        return [null, null, null, null, null, null, msg, null];\n    } else {\n        // fromnode kh√¥ng kh·ªõp ‚Üí return 8 nulls\n        return new Array(8).fill(null);\n    }\n}\n\nif (p && p.action === \"cancelled\") {\n    // Ng∆∞·ªùi d√πng b·∫•m H·ªßy ‚Üí lu√¥n 8 nulls\n    return new Array(8).fill(null);\n}\n\n// C√°c tr∆∞·ªùng h·ª£p kh√°c\nreturn new Array(8).fill(null);",
        "outputs": 7,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 900,
        "wires": [
            [
                "aa1bb2ea3e314350"
            ],
            [
                "37bdfc5c70690b99"
            ],
            [
                "a4072e969b813247"
            ],
            [
                "ef3232a9d8ab497a"
            ],
            [
                "56f840a0ad63f266"
            ],
            [
                "59da42f5c37a15f7"
            ],
            [
                "bea27f517f04a9e7"
            ]
        ]
    },
    {
        "id": "7326b163b12abb97",
        "type": "function",
        "z": "a8b7dad562bce556",
        "name": "Show Form",
        "func": "// Check n·∫øu r·ªóng ƒë·ªÉ tr√°nh show modal th·ª´a\nif (!msg.payload || msg.payload === \"\" || msg.payload === undefined || msg.payload === null) {\n    return null;\n}\n\n// Wrap th√†nh object\nmsg.payload = { action: \"showForm\", fromnode: msg.payload };\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 310,
        "y": 900,
        "wires": [
            [
                "3dca5b9467d8c56d"
            ]
        ]
    },
    {
        "id": "f335eb7f8a0a60f9",
        "type": "function",
        "z": "a8b7dad562bce556",
        "name": "AI",
        "func": "// Inputs t·ª´ flow (node tr∆∞·ªõc ƒë√≥ set v√†o)\nconst T = flow.get(\"temperature\");    // ¬∞C, c·∫£m bi·∫øn g·∫ßn p√¥\nconst H = flow.get(\"humidity\");       // %, c·∫£m bi·∫øn g·∫ßn p√¥\n\n// N·∫øu ch∆∞a c√≥ d·ªØ li·ªáu th√¨ b·ªè qua\nif (T === undefined || H === undefined) {\n    msg.payload = \"Ch∆∞a c√≥ d·ªØ li·ªáu c·∫£m bi·∫øn\";\n    return msg;\n}\n\n// Chu·∫©n h√≥a ƒë∆°n gi·∫£n cho T, H\nfunction nT(v){ return Math.min(1, Math.max(0, (v - 60) / (220 - 60))); } // 60‚Äì220¬∞C\nfunction nH(v){ return Math.min(1, Math.max(0, (v - 20) / (90 - 20))); }  // 20‚Äì90%\n\nconst t = nT(T);\nconst h = nH(H);\n\n// Quy t·∫Øc baseline: t√≠nh hai th√†nh ph·∫ßn nguy c∆°\nconst riskNOx  = Math.max(0, Math.min(100, 100 * (0.8*t - 0.2*h)));\nconst riskHCCO = Math.max(0, Math.min(100, 100 * (0.6*(1 - t) + 0.4*h)));\n\n// ƒêi·ªÉm nguy c∆° t·ªïng h·ª£p (target t·∫°m ƒë·ªÉ m√¥ h√¨nh h·ªçc theo)\nlet y = Math.round(0.5 * riskNOx + 0.5 * riskHCCO);\n\n// Cho ph√©p ghi ƒë√® target n·∫øu c√≥ nh√£n th·ª±c (vd. ƒëo CO/HC)\nconst yOverride = flow.get(\"emissionsLabel\"); // 0‚Äì100 n·∫øu c√≥\nif (typeof yOverride === \"number\") y = yOverride;\n\n// T·∫≠p d·ªØ li·ªáu hu·∫•n luy·ªán\nlet X = flow.get(\"trainX\") || [];\nlet Y = flow.get(\"trainY\") || [];\nX.push([t, h, t*h, t*t, h*h]); // th√™m ƒë·∫∑c tr∆∞ng t∆∞∆°ng t√°c v√† phi tuy·∫øn\nY.push(y);\n\nflow.set(\"trainX\", X);\nflow.set(\"trainY\", Y);\n\n// Tr·ªçng s·ªë cho 5 ƒë·∫∑c tr∆∞ng + bias\nlet W = flow.get(\"weights\") || [0, 0, 0, 0, 0];\nlet b = flow.get(\"bias\") || 0;\n\n// Hu·∫•n luy·ªán b·∫±ng SGD\nconst lr = 0.02;\nconst epochs = 5;\n\nfor (let e = 0; e < epochs; e++) {\n  for (let i = 0; i < X.length; i++) {\n    const xi = X[i];\n    const yi = Y[i];\n    const pred = W[0]*xi[0] + W[1]*xi[1] + W[2]*xi[2] + W[3]*xi[3] + W[4]*xi[4] + b;\n    const err = yi - pred;\n\n    // c·∫≠p nh·∫≠t tr·ªçng s·ªë\n    for (let k = 0; k < W.length; k++) {\n      W[k] += lr * err * xi[k];\n    }\n    b += lr * err;\n  }\n}\n\nflow.set(\"weights\", W);\nflow.set(\"bias\", b);\n\n// D·ª± ƒëo√°n hi·ªán t·∫°i\nconst xNow = [t, h, t*h, t*t, h*h];\nlet pred = W[0]*xNow[0] + W[1]*xNow[1] + W[2]*xNow[2] + W[3]*xNow[3] + W[4]*xNow[4] + b;\npred = Math.max(0, Math.min(100, pred));\n\n// L∆∞u l·∫°i ƒë·ªÉ ƒë·ªìng b·ªô v·ªõi flow\nflow.set(\"environmentDanger\", pred);\n\n// Xu·∫•t k·∫øt qu·∫£: ch·ªâ m·ªôt s·ªë duy nh·∫•t cho chart\nmsg.payload = pred;\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 410,
        "y": 640,
        "wires": [
            [
                "8926b10b94454dfc"
            ]
        ]
    },
    {
        "id": "7ff99e5be6390be6",
        "type": "debug",
        "z": "a8b7dad562bce556",
        "name": "debug 1",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 320,
        "y": 180,
        "wires": []
    },
    {
        "id": "91cae4e300f0f441",
        "type": "global-config",
        "env": [],
        "modules": {
            "node-red-dashboard": "3.6.6",
            "node-red-contrib-chatbot": "1.2.4",
            "node-red-node-email": "5.0.2"
        }
    }
]