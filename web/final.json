[
    {
        "id": "8643b3f6744861e3",
        "type": "tab",
        "label": "Flow 1",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "bce9cff3e30ba510",
        "type": "mqtt in",
        "z": "8643b3f6744861e3",
        "name": "esp32",
        "topic": "23clc06/23127491-23127483-23127467/in",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "ad9ea5942d3d9534",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 130,
        "y": 200,
        "wires": [
            [
                "a0f2aba75b6dfe9b",
                "9cfff5b326971856"
            ]
        ]
    },
    {
        "id": "334666d4d40d60e2",
        "type": "function",
        "z": "8643b3f6744861e3",
        "name": "Cloud In",
        "func": "// l·∫•y d·ªØ li·ªáu t·ª´ flow context\nvar temperature = flow.get(\"temperature\");\nvar humidity = flow.get(\"humidity\");\nvar brightness = flow.get(\"brightness\");\nvar velocity = flow.get(\"velocity\");\nvar distance = flow.get(\"distance\");\n\n// t·∫°o URL update cho ThingSpeak\nmsg.url = \"https://api.thingspeak.com/update?api_key=ST0K7JT3JRVC4PFI\"\n    + \"&field1=\" + (temperature || \"\")\n    + \"&field2=\" + (humidity || \"\")\n    + \"&field3=\" + (brightness || \"\")\n    + \"&field4=\" + (velocity || \"\")\n    + \"&field5=\" + (distance || \"\");\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 340,
        "wires": [
            [
                "fb7fe00ea2ec6184"
            ]
        ]
    },
    {
        "id": "09c8cd78f0bcd0ad",
        "type": "ui_chart",
        "z": "8643b3f6744861e3",
        "name": "Temperature",
        "group": "d5d2d5fa1fc29455",
        "order": 1,
        "width": 0,
        "height": 0,
        "label": "Temperature",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "0",
        "ymax": "50",
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "3600",
        "cutout": 0,
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "useDifferentColor": false,
        "className": "",
        "x": 750,
        "y": 380,
        "wires": [
            []
        ]
    },
    {
        "id": "b69bb5a2ed19d7be",
        "type": "mqtt out",
        "z": "8643b3f6744861e3",
        "name": "esp32",
        "topic": "23clc06/23127491/in",
        "qos": "2",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "ad9ea5942d3d9534",
        "x": 590,
        "y": 120,
        "wires": []
    },
    {
        "id": "8a9a4649cf3efcdc",
        "type": "function",
        "z": "8643b3f6744861e3",
        "name": "Random Data",
        "func": "// H√†m random trong kho·∫£ng\nfunction randomInRange(min, max) {\n    return Math.floor(Math.random() * (max - min + 1)) + min;\n}\n\n// H√†m t·∫°o dao ƒë·ªông \"th·∫≠t h∆°n\"\nfunction realisticRandom(prev, min, max, commonMin, commonMax) {\n    let r = Math.random();\n\n    if (r < 0.4) {\n        // 40% dao ƒë·ªông quanh m·ª©c ph·ªï bi·∫øn (common range)\n        let base = randomInRange(commonMin, commonMax);\n        let variation = (Math.random() * 0.2 - 0.1) * base; // ¬±10%\n        let newVal = base + variation;\n        return Math.min(max, Math.max(min, Math.round(newVal)));\n    } else if (r < 0.45) {\n        // 5% dao ƒë·ªông nh·∫π quanh gi√° tr·ªã tr∆∞·ªõc ƒë√≥\n        let variation = (Math.random() * 0.1 - 0.05) * prev; // ¬±5%\n        let newVal = prev + variation;\n        return Math.min(max, Math.max(min, Math.round(newVal)));\n    } else if (r < 0.5) {\n        // 5% dao ƒë·ªông \"k√¨ qu·∫∑c\" (ngo√†i v√πng ph·ªï bi·∫øn)\n        let newVal = randomInRange(min, max);\n        return newVal;\n    } else {\n        // 50% gi·ªØ nguy√™n gi√° tr·ªã tr∆∞·ªõc ƒë√≥\n        return prev !== undefined ? prev : randomInRange(commonMin, commonMax);\n    }\n}\n\n// L·∫•y gi√° tr·ªã tr∆∞·ªõc ƒë√≥ t·ª´ flow context\nlet prevData = flow.get(\"prevData\") || {};\n\n// Sinh d·ªØ li·ªáu gi·∫£ l·∫≠p\nvar payload = {\n    type: \"Data\",\n    temperature: realisticRandom(prevData.temperature || 25, 10, 50, 28, 40),   // ¬∞C\n    humidity: realisticRandom(prevData.humidity || 50, 30, 90, 40, 60),        // %\n    brightness: realisticRandom(prevData.brightness || 500, 0, 1000, 200, 800),// lux\n    velocity: realisticRandom(prevData.velocity || 50, 0, 150, 40, 60),        // km/h\n    distance: realisticRandom(prevData.distance || 250, 0, 500, 100, 300)      // cm\n};\n\n// L∆∞u l·∫°i gi√° tr·ªã hi·ªán t·∫°i ƒë·ªÉ l·∫ßn sau d√πng\nflow.set(\"prevData\", payload);\n\nmsg.payload = JSON.stringify(payload);\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 420,
        "y": 120,
        "wires": [
            [
                "b69bb5a2ed19d7be"
            ]
        ]
    },
    {
        "id": "54383a4591c15f8d",
        "type": "ui_chart",
        "z": "8643b3f6744861e3",
        "name": "Brightness",
        "group": "d5d2d5fa1fc29455",
        "order": 3,
        "width": 0,
        "height": 0,
        "label": "Brightness",
        "chartType": "bar",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "0",
        "ymax": "5000",
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "60",
        "cutout": 0,
        "useOneColor": true,
        "useUTC": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#fd7d0d",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#ffbb00"
        ],
        "outputs": 1,
        "useDifferentColor": false,
        "className": "",
        "x": 750,
        "y": 460,
        "wires": [
            []
        ]
    },
    {
        "id": "7b274ef8c0dde4ea",
        "type": "ui_chart",
        "z": "8643b3f6744861e3",
        "name": "Velocity Timeline",
        "group": "e1e4c62037626eb8",
        "order": 1,
        "width": 0,
        "height": 0,
        "label": "Velocity Timeline",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "0",
        "ymax": "150",
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "60",
        "cutout": 0,
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "useDifferentColor": false,
        "className": "",
        "x": 770,
        "y": 580,
        "wires": [
            []
        ]
    },
    {
        "id": "d847728fd01608ae",
        "type": "inject",
        "z": "8643b3f6744861e3",
        "name": "Trigger Environment Danger",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "30",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 170,
        "y": 640,
        "wires": [
            [
                "d79e7a6e13604bd0"
            ]
        ]
    },
    {
        "id": "709e713a8b454516",
        "type": "ui_gauge",
        "z": "8643b3f6744861e3",
        "name": "Humidity",
        "group": "d5d2d5fa1fc29455",
        "order": 2,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "Humidity",
        "label": "units",
        "format": "{{msg.payload}}",
        "min": 0,
        "max": "100",
        "colors": [
            "#ff0000",
            "#e6e600",
            "#00ff00"
        ],
        "seg1": "",
        "seg2": "",
        "diff": false,
        "className": "",
        "x": 740,
        "y": 420,
        "wires": []
    },
    {
        "id": "8a4bbe760e6bc654",
        "type": "inject",
        "z": "8643b3f6744861e3",
        "name": "Trigger Check Violation",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "30",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 190,
        "y": 720,
        "wires": [
            [
                "3ceb287af94bc19c"
            ]
        ]
    },
    {
        "id": "3ceb287af94bc19c",
        "type": "function",
        "z": "8643b3f6744861e3",
        "name": "Count",
        "func": "// H√†m ki·ªÉm tra vi ph·∫°m\nfunction isViolation(velocity, distance) {\n    // V√≠ d·ª•: v·∫≠n t·ªëc > 60 km/h ho·∫∑c kho·∫£ng c√°ch < 50 cm th√¨ coi l√† vi ph·∫°m\n    return (velocity > 60 || distance < 30);\n}\n\n// L·∫•y d·ªØ li·ªáu t·ª´ flow\nconst velocity = flow.get(\"velocity\");\nconst distance = flow.get(\"distance\");\n\n// L·∫•y l·ªãch s·ª≠ vi ph·∫°m t·ª´ flow, n·∫øu ch∆∞a c√≥ th√¨ t·∫°o m·∫£ng r·ªóng\nlet violationHistory = flow.get(\"violationHistory\") || [];\n\n// Ki·ªÉm tra vi ph·∫°m\nif (isViolation(velocity, distance)) {\n    const now = Date.now();\n    let lastViolation = violationHistory[violationHistory.length - 1];\n\n    // N·∫øu ch∆∞a c√≥ l·ªói n√†o ho·∫∑c ƒë√£ c√°ch nhau >= 1 ph√∫t th√¨ th√™m m·ªõi\n    if (!lastViolation || (now - lastViolation.timestamp >= 60000)) {\n        violationHistory.push({\n            velocity: velocity,\n            distance: distance,\n            timestamp: now\n        });\n    }\n}\n\n// L∆∞u l·∫°i l·ªãch s·ª≠ v√†o flow\nflow.set(\"violationHistory\", violationHistory);\n\n// Tr·∫£ v·ªÅ s·ªë l·∫ßn vi ph·∫°m hi·ªán t·∫°i\nmsg.payload = violationHistory.length || 0;\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 410,
        "y": 720,
        "wires": [
            [
                "cf5a83e15aacefec"
            ]
        ]
    },
    {
        "id": "785f3c21d23386c3",
        "type": "function",
        "z": "8643b3f6744861e3",
        "name": "Cloud Out",
        "func": "var payload = (typeof msg.payload === \"string\")\n    ? JSON.parse(msg.payload)\n    : msg.payload;\n\nvar feed = payload.feeds[0];\n\n// t·∫°o msg cho t·ª´ng output\nvar msg1 = feed.field1 !== null ? { payload: feed.field1 } : null;\nvar msg2 = feed.field2 !== null ? { payload: feed.field2 } : null;\nvar msg3 = feed.field3 !== null ? { payload: feed.field3 } : null;\nvar msg4 = feed.field4 !== null ? { payload: feed.field4 } : null;\nvar msg5 = feed.field5 !== null ? { payload: feed.field5 } : null;\n\nreturn [msg1, msg2, msg3, msg5];\n",
        "outputs": 4,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 580,
        "y": 440,
        "wires": [
            [
                "09c8cd78f0bcd0ad"
            ],
            [
                "709e713a8b454516"
            ],
            [
                "54383a4591c15f8d"
            ],
            [
                "68c2b7d12aa0ea8e"
            ]
        ]
    },
    {
        "id": "68c2b7d12aa0ea8e",
        "type": "ui_chart",
        "z": "8643b3f6744861e3",
        "name": "Distance",
        "group": "e1e4c62037626eb8",
        "order": 3,
        "width": 0,
        "height": 0,
        "label": "Distance",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "0",
        "ymax": "500",
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "3600",
        "cutout": 0,
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "useDifferentColor": false,
        "className": "",
        "x": 740,
        "y": 500,
        "wires": [
            []
        ]
    },
    {
        "id": "1ec5c774fd8f324d",
        "type": "ui_gauge",
        "z": "8643b3f6744861e3",
        "name": "Velocity (Live)",
        "group": "e1e4c62037626eb8",
        "order": 2,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "Velocity (Live)",
        "label": "units",
        "format": "{{msg.payload}}",
        "min": 0,
        "max": "150",
        "colors": [
            "#00ff00",
            "#ffff00",
            "#ff0000"
        ],
        "seg1": "",
        "seg2": "",
        "diff": false,
        "className": "",
        "x": 760,
        "y": 540,
        "wires": []
    },
    {
        "id": "f105838f37bdad9d",
        "type": "ui_chart",
        "z": "8643b3f6744861e3",
        "name": "AI Analysis",
        "group": "c4365b2d258185a5",
        "order": 1,
        "width": 0,
        "height": 0,
        "label": "AI Analysis",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "0",
        "ymax": "100",
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "3600",
        "cutout": 0,
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "useDifferentColor": false,
        "className": "",
        "x": 590,
        "y": 640,
        "wires": [
            []
        ]
    },
    {
        "id": "cf5a83e15aacefec",
        "type": "ui_chart",
        "z": "8643b3f6744861e3",
        "name": "Check Violation",
        "group": "92b69d34ad87d64d",
        "order": 1,
        "width": 0,
        "height": 0,
        "label": "Check Violation",
        "chartType": "horizontalBar",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "0",
        "ymax": "100",
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "3600",
        "cutout": 0,
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "useDifferentColor": false,
        "className": "",
        "x": 600,
        "y": 720,
        "wires": [
            []
        ]
    },
    {
        "id": "59d8ccf4b2f184d7",
        "type": "mqtt out",
        "z": "8643b3f6744861e3",
        "name": "esp32",
        "topic": "23clc06/23127491-23127483-23127467/out",
        "qos": "2",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "ad9ea5942d3d9534",
        "x": 1010,
        "y": 780,
        "wires": []
    },
    {
        "id": "ad7c8845534146be",
        "type": "function",
        "z": "8643b3f6744861e3",
        "name": "core 5",
        "func": "// Sinh d·ªØ li·ªáu gi·∫£ l·∫≠p\nvar payload = {\n    type: \"Lock Request\"\n};\nconst msg1 = { payload: JSON.stringify(payload) };\nconst msg2 = {payload: \"success: Th·ª±c hi·ªán thao t√°c th√†nh c√¥ng!\"};\n\nreturn [msg1, msg2];\n",
        "outputs": 2,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 750,
        "y": 780,
        "wires": [
            [
                "59d8ccf4b2f184d7"
            ],
            [
                "6960dbcdd4c6c6aa"
            ]
        ]
    },
    {
        "id": "8c17fcd0fa5e3eb0",
        "type": "ui_button",
        "z": "8643b3f6744861e3",
        "name": "Lock Request",
        "group": "ca3e831c95101162",
        "order": 4,
        "width": 2,
        "height": 1,
        "passthru": false,
        "label": "Lock Request",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "Lock Request",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 120,
        "y": 780,
        "wires": [
            [
                "659b78ef48b72805"
            ]
        ]
    },
    {
        "id": "3706fabe9e552522",
        "type": "inject",
        "z": "8643b3f6744861e3",
        "d": true,
        "name": "Generate Data ",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "3",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 160,
        "y": 120,
        "wires": [
            [
                "8a9a4649cf3efcdc"
            ]
        ]
    },
    {
        "id": "dd0c7c3bf51e14e5",
        "type": "function",
        "z": "8643b3f6744861e3",
        "name": "core 6",
        "func": "// Sinh d·ªØ li·ªáu gi·∫£ l·∫≠p\nvar payload = {\n    type: \"Lock\"\n};\n\nconst msg1 = { payload: JSON.stringify(payload) };\nconst msg2 = {payload: \"success: Th·ª±c hi·ªán thao t√°c th√†nh c√¥ng!\"};\n\nreturn [msg1, msg2];\n",
        "outputs": 2,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 750,
        "y": 820,
        "wires": [
            [
                "59d8ccf4b2f184d7"
            ],
            [
                "6960dbcdd4c6c6aa"
            ]
        ]
    },
    {
        "id": "7d023a77eefbd04b",
        "type": "ui_button",
        "z": "8643b3f6744861e3",
        "name": "Lock",
        "group": "ca3e831c95101162",
        "order": 5,
        "width": 2,
        "height": 1,
        "passthru": false,
        "label": "Lock",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "Lock",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 150,
        "y": 820,
        "wires": [
            [
                "659b78ef48b72805"
            ]
        ]
    },
    {
        "id": "76a7e3e0996ce541",
        "type": "function",
        "z": "8643b3f6744861e3",
        "name": "core 7",
        "func": "// Sinh d·ªØ li·ªáu gi·∫£ l·∫≠p\nvar payload = {\n    type: \"Unlock\"\n};\n\nconst msg1 = { payload: JSON.stringify(payload) };\nconst msg2 = {payload: \"success: Th·ª±c hi·ªán thao t√°c th√†nh c√¥ng!\"};\n\nreturn [msg1, msg2];\n",
        "outputs": 2,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 750,
        "y": 860,
        "wires": [
            [
                "59d8ccf4b2f184d7"
            ],
            [
                "6960dbcdd4c6c6aa"
            ]
        ]
    },
    {
        "id": "e6e4d51a1b6a270c",
        "type": "ui_button",
        "z": "8643b3f6744861e3",
        "name": "Unlock",
        "group": "ca3e831c95101162",
        "order": 6,
        "width": 2,
        "height": 1,
        "passthru": false,
        "label": "Unlock",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "Unlock",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 150,
        "y": 860,
        "wires": [
            [
                "659b78ef48b72805"
            ]
        ]
    },
    {
        "id": "6a4d781a15917e5a",
        "type": "ui_button",
        "z": "8643b3f6744861e3",
        "name": "Clear Violation",
        "group": "ca3e831c95101162",
        "order": 7,
        "width": 3,
        "height": 1,
        "passthru": false,
        "label": "Clear Violation",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "Clear Violation",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 120,
        "y": 1020,
        "wires": [
            [
                "659b78ef48b72805"
            ]
        ]
    },
    {
        "id": "9f7d7a87c431bec9",
        "type": "function",
        "z": "8643b3f6744861e3",
        "name": "core 11",
        "func": "flow.set(\"violationHistory\", []);\nmsg.payload = \"success: Th·ª±c hi·ªán thao t√°c th√†nh c√¥ng!\";\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 760,
        "y": 1020,
        "wires": [
            [
                "6960dbcdd4c6c6aa"
            ]
        ]
    },
    {
        "id": "fb7fe00ea2ec6184",
        "type": "http request",
        "z": "8643b3f6744861e3",
        "name": "",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 570,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "22399fb613c5e589",
        "type": "http request",
        "z": "8643b3f6744861e3",
        "name": "",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "https://api.thingspeak.com/channels/3189549/feeds.json?api_key=89TL01GQMO3W7D2V&results=1",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 390,
        "y": 440,
        "wires": [
            [
                "785f3c21d23386c3"
            ]
        ]
    },
    {
        "id": "a0f2aba75b6dfe9b",
        "type": "function",
        "z": "8643b3f6744861e3",
        "name": "Local Storage",
        "func": "var payload = (typeof msg.payload === \"string\") \n    ? JSON.parse(msg.payload) \n    : msg.payload;\n\nif (payload.type === \"Data\") {\n    if (payload.temperature !== null) flow.set(\"temperature\", payload.temperature);\n    if (payload.humidity !== null)    flow.set(\"humidity\", payload.humidity);\n    if (payload.brightness !== null)  flow.set(\"brightness\", payload.brightness);\n    if (payload.velocity !== null)    flow.set(\"velocity\", payload.velocity);\n    if (payload.distance !== null)    flow.set(\"distance\", payload.distance);\n}\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "2765cd172b89765b",
        "type": "inject",
        "z": "8643b3f6744861e3",
        "name": "Set Data Cloud Trigger",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "5",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 340,
        "wires": [
            [
                "334666d4d40d60e2"
            ]
        ]
    },
    {
        "id": "fa1bb62c2a8cec61",
        "type": "inject",
        "z": "8643b3f6744861e3",
        "name": "Get Data Cloud Trigger",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "30",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 440,
        "wires": [
            [
                "22399fb613c5e589"
            ]
        ]
    },
    {
        "id": "8c050e50e31ade5b",
        "type": "inject",
        "z": "8643b3f6744861e3",
        "name": "Get Data Cloud Trigger",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "5",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 560,
        "wires": [
            [
                "63eedad1fc353607"
            ]
        ]
    },
    {
        "id": "63eedad1fc353607",
        "type": "http request",
        "z": "8643b3f6744861e3",
        "name": "",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "https://api.thingspeak.com/channels/3189549/feeds.json?api_key=89TL01GQMO3W7D2V&results=1",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 390,
        "y": 560,
        "wires": [
            [
                "a634e08cabbfcb11"
            ]
        ]
    },
    {
        "id": "a634e08cabbfcb11",
        "type": "function",
        "z": "8643b3f6744861e3",
        "name": "Cloud Out",
        "func": "var payload = (typeof msg.payload === \"string\")\n    ? JSON.parse(msg.payload)\n    : msg.payload;\n\nvar feed = payload.feeds[0];\n\nvar msg4 = feed.field4 !== null ? { payload: feed.field4 } : null;\n\n\nreturn [msg4, msg4];\n",
        "outputs": 2,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 580,
        "y": 560,
        "wires": [
            [
                "1ec5c774fd8f324d"
            ],
            [
                "7b274ef8c0dde4ea"
            ]
        ]
    },
    {
        "id": "11f35554ee0d73b5",
        "type": "ui_button",
        "z": "8643b3f6744861e3",
        "name": "Notify Buzzer",
        "group": "ca3e831c95101162",
        "order": 11,
        "width": 3,
        "height": 1,
        "passthru": false,
        "label": "Notify Buzzer",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "Notify Buzzer",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 130,
        "y": 900,
        "wires": [
            [
                "659b78ef48b72805"
            ]
        ]
    },
    {
        "id": "98ed141ed9556de4",
        "type": "ui_button",
        "z": "8643b3f6744861e3",
        "name": "Notify Phone",
        "group": "ca3e831c95101162",
        "order": 12,
        "width": 3,
        "height": 1,
        "passthru": false,
        "label": "Notify Phone",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "Notify Phone",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 130,
        "y": 940,
        "wires": [
            [
                "659b78ef48b72805"
            ]
        ]
    },
    {
        "id": "7108ed20f69483da",
        "type": "ui_button",
        "z": "8643b3f6744861e3",
        "name": "Notify Email",
        "group": "ca3e831c95101162",
        "order": 10,
        "width": 3,
        "height": 1,
        "passthru": false,
        "label": "Notify Email",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "Notify Email",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 130,
        "y": 980,
        "wires": [
            [
                "659b78ef48b72805"
            ]
        ]
    },
    {
        "id": "936a4f0ad95c593a",
        "type": "function",
        "z": "8643b3f6744861e3",
        "name": "core 10",
        "func": "// Fallback cho time: N·∫øu kh√¥ng c√≥, l·∫•y th·ªùi gian hi·ªán t·∫°i (format gi·ªëng v√≠ d·ª•)\nconst time = msg.time || new Date().toLocaleString('vi-VN', { \n    day: '2-digit', \n    month: '2-digit', \n    year: 'numeric', \n    hour: '2-digit', \n    minute: '2-digit', \n    second: '2-digit', \n    hour12: true \n}).replace(',', ', ');  // Format: \"12/12/2025, 1:23:45 PM\" (d√πng vi-VN cho ti·∫øng Vi·ªát)\n\n// Fallback cho id: N·∫øu kh√¥ng c√≥, t·∫°o UUID ƒë∆°n gi·∫£n (v4 style, kh√¥ng c·∫ßn th∆∞ vi·ªán)\nfunction generateUUID() {\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n        var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\n        return v.toString(16);\n    });\n}\nconst id = msg.id || generateUUID();  // V√≠ d·ª•: \"a1b2c3d4-e5f6-4789-8901-23456789abcd\"\n\n// Gi·ªØ nguy√™n c√°c fallback kh√°c\nconst location = msg.location || \"Tr·∫°m ki·ªÉm so√°t A12\";\nconst description = msg.description || \"B·∫°n v·ª´a vi ph·∫°m giao th√¥ng (v∆∞·ª£t ƒë√®n ƒë·ªè / qu√° t·ªëc ƒë·ªô). H√¨nh ·∫£nh v√† bi√™n b·∫£n ƒë√£ ƒë∆∞·ª£c ghi nh·∫≠n t·ª± ƒë·ªông b·ªüi h·ªá th·ªëng camera.\";\nconst actions = msg.actions || [\n    \"Ki·ªÉm tra h√¨nh ·∫£nh v√† bi√™n b·∫£n trong h·ªá th·ªëng.\",\n    \"ƒê·∫øn kho b·∫°c nh√† n∆∞·ªõc ƒë·ªÉ ƒë√≥ng ph·∫°t ho·∫∑c n·ªôp ƒë∆°n khi·∫øu n·∫°i trong v√≤ng 7 ng√†y.\",\n    \"N·∫øu c·∫ßn h·ªó tr·ª£, li√™n h·ªá b·ªô ph·∫≠n h·ªó tr·ª£ theo th√¥ng tin d∆∞·ªõi.\"\n];\n\n// T·∫°o list actions HTML t·ª´ array\nconst actionsHtml = actions.map(action => `<li>${action}</li>`).join('');\n\nmsg.to = \"kingnemacc@gmail.com\";\nmsg.topic = \"Th√¥ng b√°o h·ªá th·ªëng\";\n\nmsg.payload = `\n    <!-- Email Notification Template - Responsive, inline CSS -->\n<table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"background:#f3f6f9;padding:30px 0;font-family:Arial,Helvetica,sans-serif;\">\n  <tr>\n    <td align=\"center\">\n      <table width=\"600\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"background:#ffffff;border-radius:8px;overflow:hidden;box-shadow:0 6px 18px rgba(0,0,0,0.06);\">\n        <!-- Header -->\n        <tr>\n          <td style=\"background:linear-gradient(90deg,#2563eb,#7c3aed);padding:22px 30px;color:#fff;\">\n            <h1 style=\"margin:0;font-size:20px;line-height:1.2;\">üîî Th√¥ng b√°o h·ªá th·ªëng</h1>\n            <p style=\"margin:6px 0 0;font-size:13px;opacity:0.95;\">H·ªá th·ªëng c·∫£nh b√°o t·ª± ƒë·ªông ‚Äî Vui l√≤ng ki·ªÉm tra th√¥ng tin b√™n d∆∞·ªõi.</p>\n          </td>\n        </tr>\n\n        <!-- Hero / Intro -->\n        <tr>\n          <td style=\"padding:22px 30px 0 30px;\">\n            <p style=\"margin:0 0 12px;color:#111;font-size:15px;line-height:1.5;\">\n              Xin ch√†o <strong>Ng∆∞·ªùi d√πng</strong>,\n            </p>\n            <p style=\"margin:0 0 12px;color:#333;font-size:14px;line-height:1.6;\">\n              H·ªá th·ªëng v·ª´a ph√°t hi·ªán m·ªôt s·ª± ki·ªán quan tr·ªçng li√™n quan ƒë·∫øn t√†i kho·∫£n c·ªßa b·∫°n. Vui l√≤ng ƒë·ªçc k·ªπ n·ªôi dung d∆∞·ªõi ƒë√¢y v√† l√†m theo h∆∞·ªõng d·∫´n n·∫øu c·∫ßn.\n            </p>\n          </td>\n        </tr>\n\n        <!-- Content block -->\n        <tr>\n          <td style=\"padding:8px 30px 0 30px;\">\n            <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"border-radius:6px;background:#f8fafc;border:1px solid #edf2f7;padding:14px;\">\n              <tr>\n                <td style=\"font-size:13px;color:#555;line-height:1.6;\">\n                  <strong>Th·ªùi gian:</strong> ${time}<br/>\n                  <strong>V·ªã tr√≠:</strong> ${location}<br/>\n                  <strong>M√¥ t·∫£:</strong> ${description}<br/><br/>\n                  <strong>H√†nh ƒë·ªông ƒë·ªÅ xu·∫•t:</strong>\n                  <ul style=\"margin:8px 0 0 18px;padding:0;color:#444;\">\n                    ${actionsHtml}\n                  </ul>\n                </td>\n              </tr>\n            </table>\n          </td>\n        </tr>\n\n        <!-- Big CTA -->\n        <tr>\n          <td align=\"center\" style=\"padding:18px 30px;\">\n            <a href=\"https://example.com/chi-tiet/${id}\" target=\"_blank\" style=\"display:inline-block;padding:12px 20px;border-radius:6px;text-decoration:none;font-weight:600;background:linear-gradient(90deg,#06b6d4,#3b82f6);color:#fff;\">\n              Xem chi ti·∫øt & x·ª≠ l√Ω\n            </a>\n          </td>\n        </tr>\n\n        <!-- Secondary info / long text -->\n        <tr>\n          <td style=\"padding:0 30px 18px 30px;font-size:13px;color:#555;line-height:1.6;\">\n            <p style=\"margin:0 0 10px;\">\n              <strong>Ghi ch√∫ quan tr·ªçng:</strong> N·∫øu b·∫°n cho r·∫±ng ƒë√¢y l√† nh·∫ßm l·∫´n, vui l√≤ng chu·∫©n b·ªã gi·∫•y t·ªù ch·ª©ng minh v√† th·ª±c hi·ªán khi·∫øu n·∫°i theo th·ªß t·ª•c. M·ªçi th√¥ng tin g·ª≠i l√™n h·ªá th·ªëng s·∫Ω ƒë∆∞·ª£c l∆∞u tr·ªØ v√† s·ª≠ d·ª•ng cho m·ª•c ƒë√≠ch x·ª≠ l√Ω vi ph·∫°m.\n            </p>\n            <p style=\"margin:0;\">\n              <strong>Li√™n h·ªá h·ªó tr·ª£:</strong><br/>\n              ƒêi·ªán tho·∫°i: 1900-1234 ‚Ä¢ Email: support@example.com ‚Ä¢ Gi·ªù l√†m vi·ªác: 08:00‚Äì17:00 (T2‚ÄìT6)\n            </p>\n          </td>\n        </tr>\n\n        <!-- Footer -->\n        <tr>\n          <td style=\"background:#fafafa;border-top:1px solid #f0f0f0;padding:14px 30px;font-size:12px;color:#7a7a7a;\">\n            <div style=\"display:flex;justify-content:space-between;align-items:center;\">\n              <div>¬© 2025 H·ªá th·ªëng Th√¥ng b√°o</div>\n              <div style=\"font-size:11px;opacity:0.9;\">B·∫°n nh·∫≠n email n√†y v√¨ ƒë√£ ƒëƒÉng k√Ω d·ªãch v·ª• th√¥ng b√°o t·ª± ƒë·ªông.</div>\n            </div>\n          </td>\n        </tr>\n      </table>\n    </td>\n  </tr>\n</table>\n`;\n\nconst msg1 = { payload: msg.payload, topic: msg.topic, to: msg.to };\nconst msg2 = {payload: \"success: Th·ª±c hi·ªán th√¥ng b√°o th√†nh c√¥ng!\"};\n\nreturn [msg1, msg2];",
        "outputs": 2,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 760,
        "y": 980,
        "wires": [
            [
                "4b168ce997c7cad0"
            ],
            [
                "6960dbcdd4c6c6aa"
            ]
        ]
    },
    {
        "id": "101fdaf37d82a512",
        "type": "function",
        "z": "8643b3f6744861e3",
        "name": "core 9",
        "func": "var notification = \n    \"B·∫°n v·ª´a vi ph·∫°m giao th√¥ng!\\n\" +\n    \"C·∫ßn ƒë·∫øn kho b·∫°c nh√† n∆∞·ªõc ƒë·ªÉ ƒë√≥ng ph·∫°t ho·∫∑c khi·∫øu n·∫°i!\\n\" +\n    \"Ch√∫c b·∫°n m·ªôt ng√†y t·ªët l√†nh!\";\n\nconst msg1 = { payload: notification };\nconst msg2 = {payload: \"success: Th·ª±c hi·ªán th√¥ng b√°o th√†nh c√¥ng!\"};\nreturn [msg1, msg2];",
        "outputs": 2,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 750,
        "y": 940,
        "wires": [
            [
                "0ecce5e8c352da3c"
            ],
            [
                "6960dbcdd4c6c6aa"
            ]
        ]
    },
    {
        "id": "9d9fe2459848bee1",
        "type": "function",
        "z": "8643b3f6744861e3",
        "name": "core 8",
        "func": "var payload = {\n    type: \"Notify\"\n};\n\nconst msg1 = { payload: JSON.stringify(payload) };\nconst msg2 = { payload: \"success: Th·ª±c hi·ªán th√¥ng b√°o th√†nh c√¥ng!\" };\n\nreturn [msg1, msg2];",
        "outputs": 2,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 750,
        "y": 900,
        "wires": [
            [
                "59d8ccf4b2f184d7"
            ],
            [
                "6960dbcdd4c6c6aa"
            ]
        ]
    },
    {
        "id": "4deb4c9a194c887f",
        "type": "ui_template",
        "z": "8643b3f6744861e3",
        "group": "ca3e831c95101162",
        "name": "ChatBox",
        "order": 15,
        "width": 0,
        "height": 0,
        "format": "<!-- Chatbox container -->\n<div id=\"chatBox\" style=\"\n    position: fixed;\n    bottom: 20px;\n    right: 20px;\n    width: 320px;\n    height: 420px;\n    display: flex;\n    flex-direction: column;\n    border-radius: 12px;\n    overflow: hidden;\n    box-shadow: \n        0 0 20px rgba(0, 255, 255, 0.3),\n        0 4px 30px rgba(0, 0, 0, 0.6);\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 100%);\n    color: #e0e0e0;\n    z-index: 9999;\n\">\n    <!-- Header -->\n    <div id=\"chatHeader\" style=\"\n        background: linear-gradient(90deg, #0f0f23, #16213e);\n        padding: 12px;\n        font-weight: 600;\n        text-align: center;\n        border-bottom: 1px solid rgba(0, 255, 255, 0.2);\n        color: #00ffff;\n        cursor: pointer;\n        text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);\n        transition: all 0.2s ease;\n        position: relative;\n    \">\n        <span style=\"position: relative; z-index: 1;\">üí¨ Cyber Chat</span>\n        <!-- Glow effect -->\n        <div style=\"\n            position: absolute;\n            top: 0;\n            left: 0;\n            right: 0;\n            bottom: 0;\n            background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.1), transparent);\n            opacity: 0;\n            transition: opacity 0.3s ease;\n        \"></div>\n    </div>\n\n    <!-- Body -->\n    <div id=\"chatWindow\" style=\"\n        flex: 1; \n        overflow-y: auto; \n        padding: 12px; \n        background: rgba(0, 0, 0, 0.3);\n        scrollbar-width: thin;\n        scrollbar-color: rgba(0, 255, 255, 0.5) transparent;\n    \">\n        <p\n            style=\"margin-bottom: 10px; padding: 8px 12px; border-radius: 12px; background: linear-gradient(135deg, rgba(138, 43, 226, 0.1), rgba(75, 0, 130, 0.05)); border-top: 3px solid #8a2be2; color: #8a2be2; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5); animation: messageSlideIn 0.3s ease;\">\n            <b style=\"color: #8a2be2; text-shadow: 0 0 5px rgba(138, 43, 226, 0.5);\">System:</b> Xin ch√†o, ƒë√¢y l√† chat\n            box cyber!\n        </p>\n    </div>\n\n    <!-- Footer -->\n    <div id=\"chatFooter\" style=\"\n        display: flex; \n        border-top: 1px solid rgba(0, 255, 255, 0.2); \n        background: linear-gradient(90deg, #0f0f23, #16213e); \n        padding: 10px;\n        transition: all 0.2s ease;\n    \">\n        <input id=\"chatInput\" type=\"text\" placeholder=\"Nh·∫≠p l·ªánh cyber...\"\n            style=\"\n                flex: 1; \n                padding: 8px 12px; \n                border: 1px solid rgba(0, 255, 255, 0.3);\n                border-radius: 20px; \n                margin-right: 8px; \n                background: rgba(26, 26, 46, 0.8);\n                color: #e0e0e0;\n                outline: none;\n                transition: all 0.2s ease;\n                box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);\n            \"\n            onfocus=\"this.style.borderColor='rgba(0, 255, 255, 0.6)'; this.style.boxShadow='0 0 10px rgba(0, 255, 255, 0.2)';\"\n            onblur=\"this.style.borderColor='rgba(0, 255, 255, 0.3)'; this.style.boxShadow='inset 0 2px 4px rgba(0, 0, 0, 0.3)';\"\n        />\n        <button onclick=\"sendMessage()\" id=\"sendBtn\" style=\"\n            background: linear-gradient(45deg, #00ffff, #0080ff);\n            color: white; \n            border: none; \n            border-radius: 20px; \n            padding: 8px 16px; \n            cursor: pointer;\n            font-weight: 600;\n            text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);\n            transition: all 0.3s ease;\n            box-shadow: 0 4px 15px rgba(0, 255, 255, 0.3);\n        \"\n        onmouseover=\"this.style.transform='scale(1.05)'; this.style.boxShadow='0 6px 20px rgba(0, 255, 255, 0.5)';\"\n        onmouseout=\"this.style.transform='scale(1)'; this.style.boxShadow='0 4px 15px rgba(0, 255, 255, 0.3)';\"\n        >üöÄ G·ª≠i</button>\n    </div>\n</div>\n\n<!-- N√∫t thu nh·ªè -->\n<div id=\"chatToggle\" style=\"\n    position: fixed;\n    bottom: 20px;\n    right: 20px;\n    width: 60px;\n    height: 60px;\n    border-radius: 50%;\n    background: linear-gradient(45deg, #00ffff, #0080ff);\n    color: white;\n    display: none;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    box-shadow: \n        0 0 20px rgba(0, 255, 255, 0.5),\n        0 4px 20px rgba(0, 0, 0, 0.4);\n    z-index: 9999;\n    transition: all 0.3s ease;\n    animation: pulse 2s infinite;\n\">\n    üí¨\n</div>\n\n<style>\n    @keyframes messageSlideIn {\n        from {\n            opacity: 0;\n            transform: translateX(-20px);\n        }\n\n        to {\n            opacity: 1;\n            transform: translateX(0);\n        }\n    }\n\n    @keyframes pulse {\n\n        0%,\n        100% {\n            transform: scale(1);\n        }\n\n        50% {\n            transform: scale(1.1);\n            box-shadow: 0 0 30px rgba(0, 255, 255, 0.7);\n        }\n    }\n\n    /* Custom scrollbar */\n    #chatWindow::-webkit-scrollbar {\n        width: 6px;\n    }\n\n    #chatWindow::-webkit-scrollbar-track {\n        background: rgba(0, 0, 0, 0.3);\n        border-radius: 3px;\n    }\n\n    #chatWindow::-webkit-scrollbar-thumb {\n        background: linear-gradient(180deg, #00ffff, #0080ff);\n        border-radius: 3px;\n        box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);\n    }\n\n    #chatWindow::-webkit-scrollbar-thumb:hover {\n        background: linear-gradient(180deg, #0080ff, #00ffff);\n    }\n</style>\n\n<script>\n    async function sendMessage() {\n    var input = document.getElementById(\"chatInput\");\n    var chatWindow = document.getElementById(\"chatWindow\");\n    if (input.value.trim() !== \"\") {\n      var msg = document.createElement(\"p\");\n      msg.style.cssText = \"margin-bottom: 10px; padding: 8px 12px; border-radius: 12px; background: linear-gradient(135deg, rgba(67, 181, 129, 0.2), rgba(0, 255, 0, 0.1)); border-left: 3px solid #00ff00; color: #43b581; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5); animation: messageSlideIn 0.3s ease;\";\n      msg.innerHTML = \"<b style='color:#00ff00; text-shadow: 0 0 5px rgba(0, 255, 0, 0.5);'>B·∫°n:</b> \" + input.value;\n      chatWindow.appendChild(msg);\n      chatWindow.scrollTop = chatWindow.scrollHeight;\n\n      try {\n        let response = await fetch(\"/chat\", {\n          method: \"POST\",\n          headers: {\"Content-Type\": \"application/json\"},\n          body: JSON.stringify({payload: input.value})\n        });\n        let data = await response.json();\n\n        var reply = document.createElement(\"p\");\n        reply.style.cssText = \"margin-bottom: 10px; padding: 8px 12px; border-radius: 12px; background: linear-gradient(135deg, rgba(0, 255, 255, 0.1), rgba(0, 128, 255, 0.05)); border-right: 3px solid #00ffff; color: #4da6ff; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5); animation: messageSlideIn 0.3s ease;\";\n        reply.innerHTML = \"<b style='color:#00ffff; text-shadow: 0 0 5px rgba(0, 255, 255, 0.5);'>Bot:</b> \" + data.payload;\n        chatWindow.appendChild(reply);\n        chatWindow.scrollTop = chatWindow.scrollHeight;\n      } catch (err) {\n        console.error(err);\n        var errorMsg = document.createElement(\"p\");\n        errorMsg.style.cssText = \"margin-bottom: 10px; padding: 8px 12px; border-radius: 12px; background: linear-gradient(135deg, rgba(138, 43, 226, 0.1), rgba(75, 0, 130, 0.05)); border-top: 3px solid #8a2be2; color: #ff6b6b; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5); animation: messageSlideIn 0.3s ease;\";\n        errorMsg.innerHTML = \"<b style='color:#ff6b6b; text-shadow: 0 0 5px rgba(255, 107, 107, 0.5);'>System:</b> L·ªói k·∫øt n·ªëi, th·ª≠ l·∫°i nh√©!\";\n        chatWindow.appendChild(errorMsg);\n        chatWindow.scrollTop = chatWindow.scrollHeight;\n      }\n\n      input.value = \"\";\n    }\n  }\n\n  // Enter ƒë·ªÉ g·ª≠i\n  document.getElementById(\"chatInput\").addEventListener(\"keypress\", function(e) {\n    if (e.key === \"Enter\") {\n      e.preventDefault();\n      sendMessage();\n    }\n  });\n\n  // Click header ƒë·ªÉ thu nh·ªè (th√™m hover glow)\n  document.getElementById(\"chatHeader\").addEventListener(\"click\", function() {\n    document.getElementById(\"chatBox\").style.display = \"none\";\n    document.getElementById(\"chatToggle\").style.display = \"flex\";\n  });\n  document.getElementById(\"chatHeader\").addEventListener(\"mouseenter\", function() {\n    this.querySelector('div').style.opacity = '1';\n    this.style.boxShadow = 'inset 0 0 20px rgba(0, 255, 255, 0.2)';\n  });\n  document.getElementById(\"chatHeader\").addEventListener(\"mouseleave\", function() {\n    this.querySelector('div').style.opacity = '0';\n    this.style.boxShadow = 'none';\n  });\n\n  // Click n√∫t bong b√≥ng ƒë·ªÉ m·ªü l·∫°i\n  document.getElementById(\"chatToggle\").addEventListener(\"click\", function() {\n    document.getElementById(\"chatBox\").style.display = \"flex\";\n    document.getElementById(\"chatToggle\").style.display = \"none\";\n  });\n</script>",
        "storeOutMessages": false,
        "fwdInMessages": true,
        "resendOnRefresh": false,
        "templateScope": "local",
        "className": "",
        "x": 140,
        "y": 1120,
        "wires": [
            []
        ]
    },
    {
        "id": "d114821b58594237",
        "type": "chatbot-nlpjs",
        "z": "8643b3f6744861e3",
        "name": "",
        "language": "",
        "debug": false,
        "scoreThreshold": "50",
        "x": 510,
        "y": 1380,
        "wires": [
            [
                "691e4b827a8bbdd4"
            ]
        ]
    },
    {
        "id": "4287802a64fec511",
        "type": "chatbot-nlpjs-train",
        "z": "8643b3f6744861e3",
        "name": "",
        "debug": true,
        "x": 520,
        "y": 1260,
        "wires": [
            [
                "5a4920a303ac5deb"
            ]
        ]
    },
    {
        "id": "d42eaaa9ca9993ef",
        "type": "inject",
        "z": "8643b3f6744861e3",
        "name": "Train ChatBox",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 110,
        "y": 1260,
        "wires": [
            [
                "7901ad8dc2d83df3"
            ]
        ]
    },
    {
        "id": "691e4b827a8bbdd4",
        "type": "function",
        "z": "8643b3f6744861e3",
        "name": "Generate Message",
        "func": "// 1. L·∫•y Intent an to√†n (Tr√°nh l·ªói undefined cho Dispatcher)\nvar intent = (msg.payload && msg.payload.intent) ? msg.payload.intent : \"None\";\n\n// 2. L·∫•y d·ªØ li·ªáu c·∫£m bi·∫øn (cho c√°c c√¢u h·ªèi th√¥ng s·ªë)\nvar temp = flow.get(\"temperature\") || 0;\nvar hum  = flow.get(\"humidity\") || 0;\nvar vel  = flow.get(\"velocity\") || 0;\nvar dist = flow.get(\"distance\") || 0;\nvar light = flow.get(\"brightness\") || 0;\nvar viol = flow.get(\"violationHistory\") || [];\n\nvar responseText = \"\";\n\n// 3. LOGIC TR·∫¢ L·ªúI\n\n// --- Nh√≥m Th√¥ng s·ªë C·∫£m bi·∫øn ---\nif (intent === \"ask_temp\") {\n    responseText = `Nhi·ªát ƒë·ªô hi·ªán t·∫°i l√† ${temp}¬∞C.`;\n    if(temp > 40) responseText += \" (Kh√° n√≥ng, h√£y c·∫©n th·∫≠n!)\";\n}\nelse if (intent === \"ask_humidity\") {\n    responseText = `ƒê·ªô ·∫©m m√¥i tr∆∞·ªùng l√† ${hum}%.`;\n}\nelse if (intent === \"ask_velocity\") {\n    responseText = `Xe ƒëang ch·∫°y v·ªõi t·ªëc ƒë·ªô ${vel} km/h.`;\n    if(vel > 60) responseText += \" (B·∫°n ƒëang ch·∫°y qu√° t·ªëc ƒë·ªô!)\";\n}\nelse if (intent === \"ask_distance\") {\n    responseText = `Kho·∫£ng c√°ch ƒë·∫øn v·∫≠t c·∫£n tr∆∞·ªõc m·∫∑t: ${dist} cm.`;\n}\nelse if (intent === \"ask_brightness\") {\n    var status = (light < 1200) ? \"Tr·ªùi t·ªëi (ƒê√®n t·ª± b·∫≠t)\" : \"Tr·ªùi s√°ng (ƒê√®n t·∫Øt)\";\n    responseText = `C∆∞·ªùng ƒë·ªô s√°ng: ${light} lux. -> ${status}.`;\n}\nelse if (intent === \"ask_violation\") {\n    if(viol.length === 0) responseText = \"Tuy·ªát v·ªùi! B·∫°n ch∆∞a c√≥ l·ªói vi ph·∫°m n√†o.\";\n    else responseText = `H·ªá th·ªëng ghi nh·∫≠n b·∫°n ƒë√£ c√≥ ${viol.length} l·∫ßn vi ph·∫°m an to√†n.`;\n}\nelse if (intent === \"ask_all_system\") {\n    responseText = `üìä B√°o c√°o: Nhi·ªát ƒë·ªô ${temp}¬∞C | ƒê·ªô ·∫©m ${hum}% | T·ªëc ƒë·ªô ${vel}km/h | V·∫≠t c·∫£n ${dist}cm.`;\n}\n\n// --- Nh√≥m Gi·∫£i th√≠ch Ch·ª©c nƒÉng App (M·ªöI) ---\nelse if (intent === \"explain_lock\") {\n    responseText = \"üîí Ch·ª©c nƒÉng **Lock Request**: D√πng ƒë·ªÉ ng·∫Øt Relay, t·∫Øt m√°y xe t·ª´ xa nh·∫±m ch·ªëng tr·ªôm ho·∫∑c khi kh√¥ng s·ª≠ d·ª•ng.\";\n}\nelse if (intent === \"explain_unlock\") {\n    responseText = \"üîì Ch·ª©c nƒÉng **Unlock**: D√πng ƒë·ªÉ ƒë√≥ng Relay, m·ªü kh√≥a ƒëi·ªán cho ph√©p xe ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng tr·ªü l·∫°i.\";\n}\nelse if (intent === \"explain_buzzer\") {\n    responseText = \"üîä Ch·ª©c nƒÉng **Notify Buzzer**: K√≠ch ho·∫°t c√≤i ch√≠p tr√™n xe k√™u 'b√≠p b√≠p'. D√πng ƒë·ªÉ t√¨m xe trong b√£i ho·∫∑c c·∫£nh b√°o ng∆∞·ªùi xung quanh.\";\n}\nelse if (intent === \"explain_phone\") {\n    responseText = \"üì± Ch·ª©c nƒÉng **Notify Phone**: G·ª≠i th√¥ng b√°o ƒë·∫©y (Push Notification) v·ªÅ ƒëi·ªán tho·∫°i c·ªßa ch·ªß xe th√¥ng qua ·ª©ng d·ª•ng Pushsafer.\";\n}\nelse if (intent === \"explain_email\") {\n    responseText = \"üìß Ch·ª©c nƒÉng **Notify Email**: G·ª≠i m·ªôt email c·∫£nh b√°o chi ti·∫øt (th·ªùi gian, ƒë·ªãa ƒëi·ªÉm, l·ªói) ƒë·∫øn h·ªôp th∆∞ c·ªßa ch·ªß xe.\";\n}\nelse if (intent === \"explain_clear\") {\n    responseText = \"üóëÔ∏è Ch·ª©c nƒÉng **Clear Violation**: X√≥a to√†n b·ªô l·ªãch s·ª≠ vi ph·∫°m ƒë√£ l∆∞u t·∫°m th·ªùi tr√™n h·ªá th·ªëng (Reset b·ªô ƒë·∫øm v·ªÅ 0).\";\n}\n\n// --- Nh√≥m X√£ giao ---\nelse if (intent === \"greeting\") responseText = \"Xin ch√†o! T√¥i l√† tr·ª£ l√Ω ·∫£o IoT. B·∫°n c·∫ßn ki·ªÉm tra th√¥ng s·ªë hay h·ªèi v·ªÅ ch·ª©c nƒÉng n√†o?\";\nelse if (intent === \"thanks\") responseText = \"Kh√¥ng c√≥ chi! R·∫•t vui ƒë∆∞·ª£c h·ªó tr·ª£ b·∫°n.\";\nelse if (intent === \"goodbye\") responseText = \"T·∫°m bi·ªát! L√°i xe an to√†n nh√©.\";\n\n// --- Fallback ---\nelse {\n    responseText = \"Xin l·ªói, t√¥i ch∆∞a hi·ªÉu r√µ. B·∫°n c√≥ th·ªÉ h·ªèi 'Nhi·ªát ƒë·ªô', 'Lock ƒë·ªÉ l√†m g√¨' ho·∫∑c 'B√°o c√°o h·ªá th·ªëng'.\";\n}\n\n// 4. QUAN TR·ªåNG: ƒê√≥ng g√≥i l·∫°i payload ƒë·ªÉ Dispatcher ho·∫°t ƒë·ªông\nmsg.payload.payload = responseText;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 730,
        "y": 1380,
        "wires": [
            [
                "6d2a750f8fb61d3e"
            ]
        ]
    },
    {
        "id": "04b2667ccd30b358",
        "type": "http in",
        "z": "8643b3f6744861e3",
        "name": "ChatBot In",
        "url": "/chat",
        "method": "post",
        "upload": false,
        "skipBodyParsing": false,
        "swaggerDoc": "",
        "x": 100,
        "y": 1380,
        "wires": [
            [
                "b38332956c4dc038"
            ]
        ]
    },
    {
        "id": "b38332956c4dc038",
        "type": "function",
        "z": "8643b3f6744861e3",
        "name": "Prepare Data",
        "func": "msg.payload = msg.payload.payload || \"\";\nflow.set(\"data\", msg.payload);\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 290,
        "y": 1380,
        "wires": [
            [
                "d114821b58594237"
            ]
        ]
    },
    {
        "id": "5a4920a303ac5deb",
        "type": "chatbot-nlpjs-save",
        "z": "8643b3f6744861e3",
        "filename": "default",
        "outputs": 0,
        "x": 750,
        "y": 1260,
        "wires": []
    },
    {
        "id": "9ad26c57f6642042",
        "type": "chatbot-nlpjs-load",
        "z": "8643b3f6744861e3",
        "filename": "default",
        "name": "default",
        "x": 290,
        "y": 1320,
        "wires": [
            []
        ]
    },
    {
        "id": "03e98ad040651e52",
        "type": "inject",
        "z": "8643b3f6744861e3",
        "name": "Load ChatBox",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 110,
        "y": 1320,
        "wires": [
            [
                "9ad26c57f6642042"
            ]
        ]
    },
    {
        "id": "fc744d8c70d236e7",
        "type": "http response",
        "z": "8643b3f6744861e3",
        "name": "ChatBot Out",
        "statusCode": "",
        "headers": {},
        "x": 890,
        "y": 1460,
        "wires": []
    },
    {
        "id": "7901ad8dc2d83df3",
        "type": "function",
        "z": "8643b3f6744861e3",
        "name": "Prepare Dataset",
        "func": "msg.payload = {\n  intents: {\n    vi: {\n      // --- NH√ìM X√É GIAO (Gi·ªØ nguy√™n) ---\n      thanks: [\"C·∫£m ∆°n\", \"C·∫£m ∆°n em\", \"Thanks\", \"Ok thanks\", \"C√°m ∆°n nha\", \"ƒê∆∞·ª£c r·ªìi c·∫£m ∆°n\"],\n      greeting: [\"Xin ch√†o\", \"Ch√†o bot\", \"Hello\", \"Hi\", \"Ch√†o ƒë·∫±ng ·∫•y\", \"Alo\", \"C√≥ ai kh√¥ng\"],\n      goodbye: [\"T·∫°m bi·ªát\", \"Bye bye\", \"H·∫πn g·∫∑p l·∫°i\", \"Th√¥i ch√†o nh√©\", \"ƒêi ƒë√¢y\"],\n\n      // --- NH√ìM TRA C·ª®U C·∫¢M BI·∫æN (M·ªü r·ªông c√¢u h·ªèi) ---\n      ask_temp: [\n        \"Nhi·ªát ƒë·ªô\", \"Nhi·ªát ƒë·ªô bao nhi√™u\", \"Tr·ªùi n√≥ng kh√¥ng\", \"Ki·ªÉm tra nhi·ªát ƒë·ªô\", \n        \"ƒê·ªông c∆° c√≥ n√≥ng kh√¥ng\", \"Temp l√† bao nhi√™u\", \"Nhi·ªát ƒë·ªô hi·ªán t·∫°i\", \n        \"B√°o c√°o nhi·ªát ƒë·ªô\", \"Th·ªùi ti·∫øt th·∫ø n√†o\", \"Check temp\"\n      ],\n      ask_humidity: [\n        \"ƒê·ªô ·∫©m\", \"ƒê·ªô ·∫©m bao nhi√™u\", \"Tr·ªùi n·ªìm kh√¥ng\", \"Ki·ªÉm tra ƒë·ªô ·∫©m\", \n        \"Humidity hi·ªán t·∫°i\", \"Kh√¥ng kh√≠ c√≥ ·∫©m kh√¥ng\", \"Check humidity\",\n        \"ƒê·ªô ·∫©m m√¥i tr∆∞·ªùng\"\n      ],\n      ask_velocity: [\n        \"T·ªëc ƒë·ªô\", \"T·ªëc ƒë·ªô xe\", \"Xe ch·∫°y nhanh kh√¥ng\", \"V·∫≠n t·ªëc bao nhi√™u\", \n        \"Ki·ªÉm tra v·∫≠n t·ªëc\", \"ƒêang ch·∫°y bao nhi√™u km/h\", \"Velocity\"\n      ],\n      ask_distance: [\n        \"Kho·∫£ng c√°ch\", \"Kho·∫£ng c√°ch v·∫≠t c·∫£n\", \"C√≥ ch∆∞·ªõng ng·∫°i v·∫≠t kh√¥ng\", \n        \"Check distance\", \"ƒêo kho·∫£ng c√°ch\", \"V·∫≠t c·∫£n bao xa\"\n      ],\n      ask_brightness: [\n        \"√Ånh s√°ng\", \"Tr·ªùi s√°ng hay t·ªëi\", \"ƒê·ªô s√°ng bao nhi√™u\", \"Ki·ªÉm tra ƒë√®n\", \n        \"Check light\", \"C∆∞·ªùng ƒë·ªô √°nh s√°ng\"\n      ],\n      ask_violation: [\n        \"Vi ph·∫°m\", \"T√¥i c√≥ b·ªã ph·∫°t kh√¥ng\", \"Ki·ªÉm tra l·ªói\", \"S·ªë l·∫ßn vi ph·∫°m\", \n        \"L·ªãch s·ª≠ vi ph·∫°m\", \"Check violation\", \"C√≥ bi√™n b·∫£n n√†o kh√¥ng\"\n      ],\n      ask_all_system: [\n        \"B√°o c√°o h·ªá th·ªëng\", \"T√¨nh tr·∫°ng xe\", \"T·ªïng quan xe\", \"Ki·ªÉm tra t·∫•t c·∫£\", \n        \"System check\", \"B√°o c√°o ƒëi\", \"T√¨nh h√¨nh sao r·ªìi\"\n      ],\n\n      // --- NH√ìM GI·∫¢I TH√çCH CH·ª®C NƒÇNG APP (M·ªõi th√™m) ---\n      explain_lock: [\n        \"Lock ƒë·ªÉ l√†m g√¨\", \"N√∫t Lock c√≥ t√°c d·ª•ng g√¨\", \"T·∫°i sao ph·∫£i Lock\", \n        \"Ch·ª©c nƒÉng kh√≥a xe\", \"Khi n√†o d√πng Lock\", \"Lock l√† g√¨\"\n      ],\n      explain_unlock: [\n        \"Unlock ƒë·ªÉ l√†m g√¨\", \"N√∫t Unlock c√≥ t√°c d·ª•ng g√¨\", \"M·ªü kh√≥a l√†m chi\", \n        \"Ch·ª©c nƒÉng m·ªü kh√≥a\", \"Unlock l√† g√¨\", \"Khi n√†o c·∫ßn Unlock\"\n      ],\n      explain_buzzer: [\n        \"Notify Buzzer l√† g√¨\", \"C√≤i b√°o ƒë·ªông ƒë·ªÉ l√†m g√¨\", \"T·∫°i sao c·∫ßn b·∫•m Buzzer\", \n        \"N√∫t Buzzer d√πng khi n√†o\", \"Buzzer c√≥ t√°c d·ª•ng g√¨\", \"Ch·ª©c nƒÉng c√≤i\"\n      ],\n      explain_phone: [\n        \"Notify Phone l√† g√¨\", \"N√∫t Notify Phone ƒë·ªÉ l√†m g√¨\", \"T·∫°i sao g·ª≠i v·ªÅ ƒëi·ªán tho·∫°i\",\n        \"Ch·ª©c nƒÉng th√¥ng b√°o ƒëi·ªán tho·∫°i\"\n      ],\n      explain_email: [\n        \"Notify Email l√† g√¨\", \"G·ª≠i email ƒë·ªÉ l√†m g√¨\", \"N√∫t Email d√πng khi n√†o\",\n        \"Ch·ª©c nƒÉng th√¥ng b√°o qua mail\"\n      ],\n      explain_clear: [\n        \"Clear Violation l√† g√¨\", \"N√∫t x√≥a vi ph·∫°m ƒë·ªÉ l√†m g√¨\", \"T·∫°i sao c·∫ßn Clear Violation\",\n        \"X√≥a l·ªãch s·ª≠ ƒë·ªÉ l√†m g√¨\"\n      ]\n    }\n  }\n};\n\nflow.set(\"dataset\", msg.payload);\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 300,
        "y": 1260,
        "wires": [
            [
                "4287802a64fec511"
            ]
        ]
    },
    {
        "id": "6d2a750f8fb61d3e",
        "type": "function",
        "z": "8643b3f6744861e3",
        "name": "Combine Message",
        "func": "// L·∫•y danh s√°ch c√¢u tr·∫£ l·ªùi ƒëang t√≠ch l≈©y\nlet responses = flow.get(\"responses\") || [];\n\n// Th√™m c√¢u tr·∫£ l·ªùi m·ªõi v√†o danh s√°ch\nif (msg.payload && msg.payload.payload) {\n    responses.push(msg.payload.payload);\n}\nflow.set(\"responses\", responses);\n\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 930,
        "y": 1380,
        "wires": [
            [
                "1717fb0b60ae4e61"
            ]
        ]
    },
    {
        "id": "1717fb0b60ae4e61",
        "type": "function",
        "z": "8643b3f6744861e3",
        "name": "Dispatcher",
        "func": "let dataset = flow.get(\"dataset\") || {};\nlet intent = msg.payload.intent;\nlet text = flow.get(\"data\") || \"\";\n\n// Escape regex k√Ω t·ª± ƒë·∫∑c bi·ªát\nfunction escapeRegex(s) {\n    return s.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\");\n}\n\n// Chu·∫©n ho√° text: b·ªè d·∫•u c√¢u, ƒë∆∞a v·ªÅ lower-case\nfunction normalize(str) {\n    return str.toLowerCase().replace(/[,\\.;:!?]/g, \"\").trim();\n}\n\nif (dataset.intents && dataset.intents.vi && dataset.intents.vi[intent]) {\n    const utterances = dataset.intents.vi[intent].map(u => normalize(u));\n    let textNorm = normalize(text);\n    const oldText = textNorm;\n    let changed = false;\n\n    // Th·ª≠ t·ª´ng utterance b·∫±ng regex kh√¥ng ph√¢n bi·ªát hoa/th∆∞·ªùng\n    for (let u of utterances) {\n        const regex = new RegExp(\"\\\\b\" + escapeRegex(u) + \"\\\\b\", \"i\");\n        if (regex.test(textNorm)) {\n            textNorm = textNorm.replace(regex, \"\").trim();\n            changed = true;\n            break; // ƒë√£ x·ª≠ l√Ω intent n√†y, tho√°t lu√¥n\n        }\n    }\n\n    text = textNorm;\n\n    // N·∫øu kh√¥ng thay ƒë·ªïi, bu·ªôc tho√°t ƒë·ªÉ tr√°nh v√≤ng l·∫∑p v√¥ h·∫°n\n    if (!changed || text === oldText) {\n        text = \"\";\n    }\n\n    flow.set(\"data\", text);\n} else {\n    // Fallback: intent kh√¥ng c√≥ trong dataset\n    let responses = flow.get(\"responses\") || [];\n    if (!responses.includes(\"Xin l·ªói, t√¥i ch∆∞a hi·ªÉu √Ω b·∫°n.\")) {\n        responses.push(\"Xin l·ªói, t√¥i ch∆∞a hi·ªÉu √Ω b·∫°n.\");\n    }\n    flow.set(\"responses\", responses);\n    text = \"\";\n    flow.set(\"data\", text);\n}\n\n// Nh√°nh xu·∫•t\nif (text && text.length > 0) {\n    // c√≤n ph·∫ßn ch∆∞a x·ª≠ l√Ω => quay l·∫°i c·ªïng 1 ƒë·ªÉ classifier t√¨m intent ti·∫øp theo\n    msg.payload = text;\n    return [msg, null];\n} else {\n    // h·∫øt ph·∫ßn ch∆∞a x·ª≠ l√Ω => join v√† clear\n    let responses = flow.get(\"responses\") || [];\n    const finalResponse = responses.join(\" \");\n\n    flow.set(\"responses\", []);\n    flow.set(\"data\", \"\");\n\n    msg.payload = finalResponse;\n    return [null, msg];\n}\n",
        "outputs": 2,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 470,
        "y": 1460,
        "wires": [
            [
                "d114821b58594237"
            ],
            [
                "f690a433936a5973"
            ]
        ]
    },
    {
        "id": "f690a433936a5973",
        "type": "function",
        "z": "8643b3f6744861e3",
        "name": "Prepare Data",
        "func": "msg.payload = {payload: msg.payload};\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 690,
        "y": 1460,
        "wires": [
            [
                "fc744d8c70d236e7"
            ]
        ]
    },
    {
        "id": "4da6f4c1fed82df1",
        "type": "http request",
        "z": "8643b3f6744861e3",
        "name": "phone",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1190,
        "y": 940,
        "wires": [
            []
        ]
    },
    {
        "id": "0ecce5e8c352da3c",
        "type": "function",
        "z": "8643b3f6744861e3",
        "name": "Prepare Data",
        "func": "const message = encodeURIComponent(msg.payload || \"\");\n\nmsg.url = \"https://www.pushsafer.com/api\"\n        + \"?k=owqOKgLJxtJ5m889IYjg\"\n        + \"&m=\" + message;\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1030,
        "y": 940,
        "wires": [
            [
                "4da6f4c1fed82df1"
            ]
        ]
    },
    {
        "id": "4b168ce997c7cad0",
        "type": "e-mail",
        "z": "8643b3f6744861e3",
        "server": "smtp.gmail.com",
        "port": "465",
        "authtype": "BASIC",
        "saslformat": true,
        "token": "oauth2Response.access_token",
        "secure": true,
        "tls": true,
        "name": "huynhvansinh1810@gmail.com",
        "dname": "Email",
        "x": 1030,
        "y": 980,
        "wires": []
    },
    {
        "id": "6960dbcdd4c6c6aa",
        "type": "ui_template",
        "z": "8643b3f6744861e3",
        "group": "ca3e831c95101162",
        "name": "Toast Notify",
        "order": 1,
        "width": 0,
        "height": 0,
        "format": "<style>\n    #toast-container {\n        position: fixed;\n        top: 20px;\n        right: 20px;\n        z-index: 999999;\n        display: flex;\n        flex-direction: column;\n        gap: 12px;\n        pointer-events: none;\n    }\n\n    .toast {\n        position: relative;\n        padding: 16px 20px;\n        min-width: 280px;\n        max-width: 380px;\n        color: #fff;\n        font-size: 14px;\n        border-radius: 12px;\n        display: flex;\n        align-items: center;\n        gap: 12px;\n        background: rgba(30, 30, 30, 0.75);\n        backdrop-filter: blur(12px);\n        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.35);\n        overflow: hidden;\n\n        opacity: 0;\n        transform: translateX(40px);\n        animation: slideIn 0.45s ease forwards,\n            fadeOut 0.6s ease 4.5s forwards;\n    }\n\n    /* --- Glowing border animation --- */\n    .toast::before {\n        content: \"\";\n        position: absolute;\n        inset: 0;\n        border-radius: 12px;\n        padding: 2px;\n        background: linear-gradient(130deg,\n                #16a34a,\n                #22d3ee,\n                #6366f1,\n                #f43f5e,\n                #f59e0b);\n        background-size: 300% 300%;\n        animation: glowBorder 3s linear infinite;\n        -webkit-mask:\n            linear-gradient(#fff 0 0) content-box,\n            linear-gradient(#fff 0 0);\n        -webkit-mask-composite: xor;\n        mask-composite: exclude;\n    }\n\n    /* m√†u theo lo·∫°i */\n    .toast.success::before {\n        filter: hue-rotate(0deg);\n    }\n\n    .toast.error::before {\n        filter: hue-rotate(280deg);\n    }\n\n    .toast.warning::before {\n        filter: hue-rotate(80deg);\n    }\n\n    .toast.info::before {\n        filter: hue-rotate(180deg);\n    }\n\n    @keyframes glowBorder {\n        0% {\n            background-position: 0% 50%;\n        }\n\n        50% {\n            background-position: 100% 50%;\n        }\n\n        100% {\n            background-position: 0% 50%;\n        }\n    }\n\n    @keyframes slideIn {\n        to {\n            opacity: 1;\n            transform: translateX(0);\n        }\n    }\n\n    @keyframes fadeOut {\n        to {\n            opacity: 0;\n            transform: translateX(40px);\n        }\n    }\n\n    .icon {\n        font-size: 20px;\n        opacity: 0.9;\n    }\n</style>\n\n\n<div id=\"toast-container\"></div>\n\n<script>\n    (function(scope) {\n\n    scope.$watch(\"msg\", function(msg) {\n        if (!msg || !msg.payload) return;\n\n        let raw = String(msg.payload);\n        let type = \"info\";\n        let text = raw;\n\n        if (raw.startsWith(\"success:\")) { type = \"success\"; text = raw.replace(\"success:\", \"\").trim(); }\n        else if (raw.startsWith(\"error:\")) { type = \"error\"; text = raw.replace(\"error:\", \"\").trim(); }\n        else if (raw.startsWith(\"warning:\")) { type = \"warning\"; text = raw.replace(\"warning:\", \"\").trim(); }\n        else if (raw.startsWith(\"info:\")) { type = \"info\"; text = raw.replace(\"info:\", \"\").trim(); }\n\n        const icons = {\n            success: \"‚úî\",\n            error: \"‚úñ\",\n            warning: \"‚ö†\",\n            info: \"‚Ñπ\"\n        };\n\n        const toast = document.createElement(\"div\");\n        toast.className = \"toast \" + type;\n        toast.innerHTML = `\n            <div class=\"icon\">${icons[type]}</div>\n            <div>${text}</div>\n        `;\n\n        const container = document.getElementById(\"toast-container\");\n        container.appendChild(toast);\n\n        setTimeout(() => toast.remove(), 5000);\n    });\n\n})(scope);\n</script>",
        "storeOutMessages": false,
        "fwdInMessages": true,
        "resendOnRefresh": false,
        "templateScope": "local",
        "className": "",
        "x": 1030,
        "y": 880,
        "wires": [
            []
        ]
    },
    {
        "id": "8753c397f10955fb",
        "type": "ui_template",
        "z": "8643b3f6744861e3",
        "group": "ca3e831c95101162",
        "name": "Form",
        "order": 2,
        "width": 0,
        "height": 0,
        "format": "<style>\n    /* Overlay m·ªù */\n    #custom-modal-overlay {\n        position: fixed;\n        inset: 0;\n        background: rgba(0, 0, 0, 0.45);\n        backdrop-filter: blur(4px);\n        display: none;\n        justify-content: center;\n        align-items: center;\n        z-index: 999998;\n    }\n\n    /* Popup */\n    #custom-modal {\n        width: 380px;\n        padding: 22px;\n        background: rgba(255, 255, 255, 0.10);\n        border: 1px solid rgba(255, 255, 255, 0.2);\n        backdrop-filter: blur(16px);\n        border-radius: 14px;\n        box-shadow: 0 10px 28px rgba(0, 0, 0, 0.35);\n        color: #fff;\n        opacity: 0;\n        transform: scale(0.85);\n        transition: 0.25s ease;\n    }\n\n    #custom-modal.show {\n        opacity: 1;\n        transform: scale(1);\n    }\n\n    /* Title */\n    #custom-modal h3 {\n        margin: 0 0 10px 0;\n        font-size: 18px;\n        font-weight: 600;\n    }\n\n    /* Buttons */\n    .modal-btns {\n        display: flex;\n        justify-content: flex-end;\n        margin-top: 20px;\n        gap: 10px;\n    }\n\n    .btn {\n        padding: 8px 16px;\n        border-radius: 8px;\n        cursor: pointer;\n        border: none;\n        font-weight: 500;\n        transition: 0.2s;\n    }\n\n    .btn.cancel {\n        background: rgba(255, 255, 255, 0.15);\n        color: #fff;\n    }\n\n    .btn.cancel:hover {\n        background: rgba(255, 255, 255, 0.25);\n    }\n\n    .btn.ok {\n        background: #2563eb;\n        color: #fff;\n    }\n\n    .btn.ok:hover {\n        background: #1d4ed8;\n    }\n</style>\n\n<!-- Modal -->\n<div id=\"custom-modal-overlay\">\n    <div id=\"custom-modal\">\n        <h3>X√°c nh·∫≠n thao t√°c</h3>\n        <p>B·∫°n c√≥ ch·∫Øc mu·ªën th·ª±c hi·ªán h√†nh ƒë·ªông n√†y?</p>\n        <div class=\"modal-btns\">\n            <button class=\"btn cancel\" ng-click=\"cancelModal()\">H·ªßy</button>\n            <button class=\"btn ok\" ng-click=\"confirmModal()\">ƒê·ªìng √Ω</button>\n        </div>\n    </div>\n</div>\n\n<script>\n    (function(scope) {\n    const overlay = document.getElementById(\"custom-modal-overlay\");\n    const modal = document.getElementById(\"custom-modal\");\n   \n    // Bi·∫øn l∆∞u fromnode t·∫°m th·ªùi\n    scope.currentFromNode = null;\n   \n    scope.$watch(\"msg\", function(msg) {\n        if (!msg || !msg.payload) return;\n        let p = msg.payload;\n        if (p && p.action === \"showForm\") {\n            // Th√™m check: N·∫øu fromnode r·ªóng, warn v√† kh√¥ng show modal\n            if (!p.fromnode || p.fromnode.toString().trim() === \"\") {\n                console.warn(\"Modal: fromnode r·ªóng ‚Üí Kh√¥ng show modal\");  // Log browser console\n                return;  // B·ªè qua, kh√¥ng show\n            }\n            scope.currentFromNode = p.fromnode;  // L∆∞u ch·ªâ n·∫øu h·ª£p l·ªá\n            showModal();\n        }\n        if (p && p.action === \"hideForm\") {\n            hideModal();\n        }\n    });\n\n    function showModal() {\n        overlay.style.display = \"flex\";\n        setTimeout(() => modal.classList.add(\"show\"), 20);\n    }\n\n    function hideModal() {\n        modal.classList.remove(\"show\");\n        setTimeout(() => overlay.style.display = \"none\", 200);\n        scope.currentFromNode = null;  // Reset\n    }\n\n    scope.cancelModal = function() {\n        let result = { action: \"cancelled\" };\n        if (scope.currentFromNode !== null && scope.currentFromNode.toString().trim() !== \"\") {\n            result.fromnode = scope.currentFromNode;\n        }\n        hideModal();\n        scope.send({ payload: result });\n    };\n\n    scope.confirmModal = function() {\n        let result = { action: \"confirmed\" };\n        if (scope.currentFromNode !== null && scope.currentFromNode.toString().trim() !== \"\") {\n            result.fromnode = scope.currentFromNode;\n        }\n        hideModal();\n        scope.send({ payload: result });\n    };\n})(scope);\n</script>",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "resendOnRefresh": false,
        "templateScope": "local",
        "className": "",
        "x": 450,
        "y": 900,
        "wires": [
            [
                "2ba9158e054cd4eb"
            ]
        ]
    },
    {
        "id": "2ba9158e054cd4eb",
        "type": "function",
        "z": "8643b3f6744861e3",
        "name": "Check",
        "func": "let p = msg.payload;\n\nif (p && p.action === \"confirmed\") {\n    // Ng∆∞·ªùi d√πng b·∫•m ƒê·ªìng √Ω\n    let fromNode = (p.fromnode || \"\").toString().trim();  // Trim space th·ª´a, convert sang string n·∫øu c·∫ßn\n    if (fromNode === \"Lock Request\") {\n\n        return [msg, null, null, null, null, null, null, null];\n    } else if (fromNode === \"Lock\") {\n        return [null, msg, null, null, null, null, null, null];\n    } else if (fromNode === \"Unlock\") {\n        return [null, null, msg, null, null, null, null, null];\n    } else if (fromNode === \"Notify Buzzer\") {\n        return [null, null, null, msg, null, null, null, null];\n    } else if (fromNode === \"Notify Phone\") {\n        return [null, null, null, null, msg, null, null, null];\n    } else if (fromNode === \"Notify Email\") {\n        return [null, null, null, null, null, msg, null, null];\n    } else if (fromNode === \"Clear Violation\") {\n        return [null, null, null, null, null, null, msg, null];\n    } else {\n        // fromnode kh√¥ng kh·ªõp ‚Üí return 8 nulls\n        return new Array(8).fill(null);\n    }\n}\n\nif (p && p.action === \"cancelled\") {\n    // Ng∆∞·ªùi d√πng b·∫•m H·ªßy ‚Üí lu√¥n 8 nulls\n    return new Array(8).fill(null);\n}\n\n// C√°c tr∆∞·ªùng h·ª£p kh√°c\nreturn new Array(8).fill(null);",
        "outputs": 7,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 900,
        "wires": [
            [
                "ad7c8845534146be"
            ],
            [
                "dd0c7c3bf51e14e5"
            ],
            [
                "76a7e3e0996ce541"
            ],
            [
                "9d9fe2459848bee1"
            ],
            [
                "101fdaf37d82a512"
            ],
            [
                "936a4f0ad95c593a"
            ],
            [
                "9f7d7a87c431bec9"
            ]
        ]
    },
    {
        "id": "659b78ef48b72805",
        "type": "function",
        "z": "8643b3f6744861e3",
        "name": "Show Form",
        "func": "// Check n·∫øu r·ªóng ƒë·ªÉ tr√°nh show modal th·ª´a\nif (!msg.payload || msg.payload === \"\" || msg.payload === undefined || msg.payload === null) {\n    return null;\n}\n\n// Wrap th√†nh object\nmsg.payload = { action: \"showForm\", fromnode: msg.payload };\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 310,
        "y": 900,
        "wires": [
            [
                "8753c397f10955fb"
            ]
        ]
    },
    {
        "id": "d79e7a6e13604bd0",
        "type": "function",
        "z": "8643b3f6744861e3",
        "name": "AI",
        "func": "// Inputs t·ª´ flow (node tr∆∞·ªõc ƒë√≥ set v√†o)\nconst T = flow.get(\"temperature\");    // ¬∞C, c·∫£m bi·∫øn g·∫ßn p√¥\nconst H = flow.get(\"humidity\");       // %, c·∫£m bi·∫øn g·∫ßn p√¥\n\n// N·∫øu ch∆∞a c√≥ d·ªØ li·ªáu th√¨ b·ªè qua\nif (T === undefined || H === undefined) {\n    msg.payload = \"Ch∆∞a c√≥ d·ªØ li·ªáu c·∫£m bi·∫øn\";\n    return msg;\n}\n\n// Chu·∫©n h√≥a ƒë∆°n gi·∫£n cho T, H\nfunction nT(v){ return Math.min(1, Math.max(0, (v - 60) / (220 - 60))); } // 60‚Äì220¬∞C\nfunction nH(v){ return Math.min(1, Math.max(0, (v - 20) / (90 - 20))); }  // 20‚Äì90%\n\nconst t = nT(T);\nconst h = nH(H);\n\n// Quy t·∫Øc baseline: t√≠nh hai th√†nh ph·∫ßn nguy c∆°\nconst riskNOx  = Math.max(0, Math.min(100, 100 * (0.8*t - 0.2*h)));\nconst riskHCCO = Math.max(0, Math.min(100, 100 * (0.6*(1 - t) + 0.4*h)));\n\n// ƒêi·ªÉm nguy c∆° t·ªïng h·ª£p (target t·∫°m ƒë·ªÉ m√¥ h√¨nh h·ªçc theo)\nlet y = Math.round(0.5 * riskNOx + 0.5 * riskHCCO);\n\n// Cho ph√©p ghi ƒë√® target n·∫øu c√≥ nh√£n th·ª±c (vd. ƒëo CO/HC)\nconst yOverride = flow.get(\"emissionsLabel\"); // 0‚Äì100 n·∫øu c√≥\nif (typeof yOverride === \"number\") y = yOverride;\n\n// T·∫≠p d·ªØ li·ªáu hu·∫•n luy·ªán\nlet X = flow.get(\"trainX\") || [];\nlet Y = flow.get(\"trainY\") || [];\nX.push([t, h, t*h, t*t, h*h]); // th√™m ƒë·∫∑c tr∆∞ng t∆∞∆°ng t√°c v√† phi tuy·∫øn\nY.push(y);\n\nflow.set(\"trainX\", X);\nflow.set(\"trainY\", Y);\n\n// Tr·ªçng s·ªë cho 5 ƒë·∫∑c tr∆∞ng + bias\nlet W = flow.get(\"weights\") || [0, 0, 0, 0, 0];\nlet b = flow.get(\"bias\") || 0;\n\n// Hu·∫•n luy·ªán b·∫±ng SGD\nconst lr = 0.02;\nconst epochs = 5;\n\nfor (let e = 0; e < epochs; e++) {\n  for (let i = 0; i < X.length; i++) {\n    const xi = X[i];\n    const yi = Y[i];\n    const pred = W[0]*xi[0] + W[1]*xi[1] + W[2]*xi[2] + W[3]*xi[3] + W[4]*xi[4] + b;\n    const err = yi - pred;\n\n    // c·∫≠p nh·∫≠t tr·ªçng s·ªë\n    for (let k = 0; k < W.length; k++) {\n      W[k] += lr * err * xi[k];\n    }\n    b += lr * err;\n  }\n}\n\nflow.set(\"weights\", W);\nflow.set(\"bias\", b);\n\n// D·ª± ƒëo√°n hi·ªán t·∫°i\nconst xNow = [t, h, t*h, t*t, h*h];\nlet pred = W[0]*xNow[0] + W[1]*xNow[1] + W[2]*xNow[2] + W[3]*xNow[3] + W[4]*xNow[4] + b;\npred = Math.max(0, Math.min(100, pred));\n\n// L∆∞u l·∫°i ƒë·ªÉ ƒë·ªìng b·ªô v·ªõi flow\nflow.set(\"environmentDanger\", pred);\n\n// Xu·∫•t k·∫øt qu·∫£: ch·ªâ m·ªôt s·ªë duy nh·∫•t cho chart\nmsg.payload = pred;\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 410,
        "y": 640,
        "wires": [
            [
                "f105838f37bdad9d"
            ]
        ]
    },
    {
        "id": "9cfff5b326971856",
        "type": "debug",
        "z": "8643b3f6744861e3",
        "name": "debug 1",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 320,
        "y": 180,
        "wires": []
    },
    {
        "id": "e19a1bc7986f4c08",
        "type": "ui_spacer",
        "z": "8643b3f6744861e3",
        "name": "spacer",
        "group": "ca3e831c95101162",
        "order": 3,
        "width": 2,
        "height": 1
    },
    {
        "id": "c4206e18e828cd44",
        "type": "ui_spacer",
        "z": "8643b3f6744861e3",
        "name": "spacer",
        "group": "ca3e831c95101162",
        "order": 8,
        "width": 1,
        "height": 1
    },
    {
        "id": "811fc04164eccf9c",
        "type": "ui_spacer",
        "z": "8643b3f6744861e3",
        "name": "spacer",
        "group": "ca3e831c95101162",
        "order": 9,
        "width": 2,
        "height": 1
    },
    {
        "id": "1d7059a2e4e65001",
        "type": "ui_spacer",
        "z": "8643b3f6744861e3",
        "name": "spacer",
        "group": "ca3e831c95101162",
        "order": 13,
        "width": 1,
        "height": 1
    },
    {
        "id": "f9652b4a15f9d624",
        "type": "ui_spacer",
        "z": "8643b3f6744861e3",
        "name": "spacer",
        "group": "ca3e831c95101162",
        "order": 14,
        "width": 12,
        "height": 1
    },
    {
        "id": "ad9ea5942d3d9534",
        "type": "mqtt-broker",
        "name": "Server 2",
        "broker": "broker.emqx.io",
        "port": 1883,
        "clientid": "",
        "autoConnect": true,
        "usetls": false,
        "protocolVersion": 4,
        "keepalive": 60,
        "cleansession": true,
        "autoUnsubscribe": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthRetain": "false",
        "birthPayload": "",
        "birthMsg": {},
        "closeTopic": "",
        "closeQos": "0",
        "closeRetain": "false",
        "closePayload": "",
        "closeMsg": {},
        "willTopic": "",
        "willQos": "0",
        "willRetain": "false",
        "willPayload": "",
        "willMsg": {},
        "userProps": "",
        "sessionExpiry": ""
    },
    {
        "id": "d5d2d5fa1fc29455",
        "type": "ui_group",
        "name": "Input Environment",
        "tab": "c1af418266c0b277",
        "order": 1,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "e1e4c62037626eb8",
        "type": "ui_group",
        "name": "Input User",
        "tab": "c1af418266c0b277",
        "order": 4,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "c4365b2d258185a5",
        "type": "ui_group",
        "name": "Environment Analysis",
        "tab": "c1af418266c0b277",
        "order": 2,
        "disp": true,
        "width": 6,
        "collapse": false,
        "className": ""
    },
    {
        "id": "92b69d34ad87d64d",
        "type": "ui_group",
        "name": "Violation Monitor",
        "tab": "c1af418266c0b277",
        "order": 3,
        "disp": true,
        "width": 6,
        "collapse": false,
        "className": ""
    },
    {
        "id": "ca3e831c95101162",
        "type": "ui_group",
        "name": "Controls",
        "tab": "c1af418266c0b277",
        "order": 5,
        "disp": true,
        "width": 12,
        "collapse": false,
        "className": ""
    },
    {
        "id": "c1af418266c0b277",
        "type": "ui_tab",
        "name": "Home",
        "icon": "dashboard",
        "disabled": false,
        "hidden": false
    },
    {
        "id": "a54c3549aa77f5dc",
        "type": "global-config",
        "env": [],
        "modules": {
            "node-red-dashboard": "3.6.6",
            "node-red-contrib-chatbot": "1.2.4",
            "node-red-node-email": "5.0.2"
        }
    }
]